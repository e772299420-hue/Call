<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background: #f6f8fa;
      margin: 0;
      padding: 0;
      direction: rtl;
    }
    header {
      background: #2980b9;
      color: #fff;
      text-align: center;
      padding: 15px 0;
      font-size: 20px;
      font-weight: bold;
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 5px;
    }
    .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    header img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      padding: 2px;
    }
    .subtitle {
      font-size: 16px;
      font-weight: normal;
      margin-top: 5px;
    }
    .marquee-container {
      background: #e8f4fc;
      padding: 10px 0;
      overflow: hidden;
      position: relative;
      border-bottom: 1px solid #d1e7f7;
    }
    .marquee {
      white-space: nowrap;
      animation: marquee 40s linear infinite;
      font-size: 16px;
      color: #000000;
      font-weight: bold;
      padding-left: 100%;
    }
    @keyframes marquee {
      0% { 
        transform: translateX(-100%);
      }
      100% { 
        transform: translateX(100%);
      }
    }
    .tabs {
      display: flex;
      background: #fff;
      border-bottom: 2px solid #ddd;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
      border-bottom: 3px solid transparent;
    }
    .tab.active {
      border-color: #2980b9;
      color: #2980b9;
    }
    .tab-content {
      display: none;
      padding: 20px;
    }
    .tab-content.active {
      display: block;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-family: inherit;
    }
    button {
      background: #2980b9;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #1c6da8;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      text-align: center;
    }
    th {
      background: #f2f2f2;
    }
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .search-box input, .search-box select {
      flex: 1;
    }
    .hidden {
      display: none;
    }
    .required::after {
      content: " *";
      color: red;
    }
    .form-section {
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 15px;
    }
    .form-section:last-child {
      border-bottom: none;
    }
    .error {
      border-color: red !important;
    }
    .error-message {
      color: red;
      font-size: 12px;
      margin-top: -10px;
      margin-bottom: 10px;
      display: none;
    }
    
    /* Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }
    .modal-title {
      font-size: 20px;
      font-weight: bold;
      color: #2980b9;
    }
    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }
    .modal-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .modal-field {
      margin-bottom: 10px;
    }
    .modal-label {
      font-weight: bold;
      color: #555;
      margin-bottom: 5px;
    }
    .modal-value {
      padding: 8px;
      background: #f9f9f9;
      border-radius: 5px;
      min-height: 20px;
    }
    .phone-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .call-btn {
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .call-btn:hover {
      background: #219653;
      transform: scale(1.1);
    }
    .view-btn {
      background: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    .view-btn:hover {
      background: #2980b9;
      transform: scale(1.05);
    }
    
    /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
    .hidden-column {
      display: none;
    }
    
    /* ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« */
    .filter-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* ØªØ®Ø·ÙŠØ· Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .form-full-width {
      grid-column: 1 / -1;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
      .filter-container {
        grid-template-columns: 1fr;
      }
      .modal-body {
        grid-template-columns: 1fr;
      }
      .modal-field[style*="grid-column: span 2"] {
        grid-column: span 1;
      }
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ù„ÙˆÙ†Ø© */
    .icon-user { color: #3498db; }
    .icon-venus-mars { color: #e74c3c; }
    .icon-birthday { color: #f39c12; }
    .icon-tint { color: #e74c3c; }
    .icon-map-marker { color: #27ae60; }
    .icon-mobile { color: #2980b9; }
    .icon-address-card { color: #8e44ad; }
    .icon-sticky-note { color: #f39c12; }
    .icon-save { color: #27ae60; }
    .icon-search { color: #3498db; }
    .icon-users { color: #2980b9; }
    .icon-pencil { color: #f39c12; }
    .icon-phone { color: #27ae60; }
    .icon-eye { color: #3498db; }
  </style>
</head>
<body>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
  <header>
    <div class="logo-container">
      <img src="https://github.com/e772299420-hue/Call/blob/main/icon-512x5122.png?raw=true" alt="Ø´Ø¹Ø§Ø±">
      <span>AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„</span>
    </div>
    <div class="subtitle">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ† ğŸ©¸</div>
  </header>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù†ØµÙŠ Ø§Ù„Ù…ØªØ­Ø±Ùƒ -->
  <div class="marquee-container">
    <div class="marquee" id="marqueeText">
      Ù‚Ø§Ù„ ØªØ¹Ø§Ù„Ù‰ ï´¿ÙˆÙÙ…ÙÙ†Ù’ Ø£ÙØ­Ù’ÙŠÙØ§Ù‡ÙØ§ ÙÙÙƒÙØ£ÙÙ†Ù‘ÙÙ…ÙØ§ Ø£ÙØ­Ù’ÙŠÙØ§ Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù Ø¬ÙÙ…ÙÙŠØ¹Ù‹Ø§ï´¾  Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©: 32
    </div>
  </div>

  <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
  <div class="tabs">
    <div class="tab" onclick="showTab(0)">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª <i class="fas fa-pencil-alt icon-pencil"></i></div>
    <div class="tab active" onclick="showTab(1)">Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ† <i class="fas fa-users icon-users"></i></div>
  </div>

  <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ -->
  <div class="tab-content" id="tab1">
    <form id="donorForm">
      <div class="hidden">
        <label>Ù…Ø¹Ø±Ù Ø§Ù„Ù…ØªØ¨Ø±Ø¹ / Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ</label>
        <input type="text" id="donorId" placeholder="ÙŠÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸" disabled>
      </div>

      <!-- Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚Ø© -->
      <div class="form-section">
        <div class="form-grid">
          <div>
            <label class="required">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© <i class="fas fa-map-marker-alt icon-map-marker"></i></label>
            <select id="governorate" required onchange="updateRegions()">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
              <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </select>
            <div class="error-message" id="governorateError">ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</div>
          </div>
          <div>
            <label class="required">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© <i class="fas fa-map-marker-alt icon-map-marker"></i></label>
            <select id="region" required>
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
              <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </select>
            <div class="error-message" id="regionError">ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</div>
          </div>
        </div>
      </div>

      <!-- Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¨Ø±Ø¹ -->
      <div class="form-section">
        <label class="required">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¨Ø±Ø¹ <i class="fas fa-user icon-user"></i></label>
        <input type="text" id="donorName" required placeholder="ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ (Ù…Ø«Ø§Ù„: Ù…Ø±ÙˆØ§Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø°Ù…Ø§Ø±ÙŠ)">
        <div class="error-message" id="nameError">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</div>
      </div>

      <!-- Ø§Ù„Ø¬Ù†Ø³ ÙˆØ§Ù„Ø¹Ù…Ø± -->
      <div class="form-section">
        <div class="form-grid">
          <div>
            <label class="required">Ø§Ù„Ø¬Ù†Ø³ <i class="fas fa-venus-mars icon-venus-mars"></i></label>
            <select id="gender" required>
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
              <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
              <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
            </select>
            <div class="error-message" id="genderError">ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³</div>
          </div>
          <div>
            <label>Ø§Ù„Ø¹Ù…Ø± <i class="fas fa-birthday-cake icon-birthday"></i></label>
            <input type="number" id="age" min="18" max="65" inputmode="numeric" placeholder="Ù…Ù† 18 Ø¥Ù„Ù‰ 65">
          </div>
        </div>
      </div>

      <!-- ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù… -->
      <div class="form-section">
        <label class="required">ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù… (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) <i class="fas fa-tint icon-tint"></i></label>
        <input type="text" id="bloodType" placeholder="Ù…Ø«Ù„Ø§Ù‹: A+, O-, B+" required inputmode="text">
        <div class="error-message" id="bloodTypeError">ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…</div>
      </div>

      <!-- Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ -->
      <div class="form-section">
        <div class="form-grid">
          <div>
            <label class="required">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ 1 <i class="fas fa-mobile-alt icon-mobile"></i></label>
            <input type="tel" id="phone1" required inputmode="tel" placeholder="771234567" maxlength="9" minlength="9">
            <div class="error-message" id="phone1Error">ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (9 Ø£Ø±Ù‚Ø§Ù…)</div>
          </div>
          <div>
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ 2 <i class="fas fa-mobile-alt icon-mobile"></i></label>
            <input type="tel" id="phone2" inputmode="tel" placeholder="Ø±Ù‚Ù… Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" maxlength="9" minlength="9">
            <div class="error-message" id="phone2Error">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø±Ù‚Ù… 9 Ø£Ø±Ù‚Ø§Ù…</div>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
      <div class="form-section">
        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒÙ† <i class="fas fa-address-card icon-address-card"></i></label>
        <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ">
      </div>

      <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
      <div class="form-section">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ <i class="fas fa-sticky-note icon-sticky-note"></i></label>
        <textarea id="notes" rows="3" placeholder="Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ù…ØªØ¨Ø±Ø¹..."></textarea>
      </div>

      <button type="submit"><i class="fas fa-save icon-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </form>
  </div>

  <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
  <div class="tab-content active" id="tab2">
    <!-- ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« -->
    <div class="filter-container">
      <div>
        <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© <i class="fas fa-map-marker-alt icon-map-marker"></i></label>
        <select id="filterGovernorate" onchange="updateFilterRegions()">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
          <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        </select>
      </div>
      <div>
        <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© <i class="fas fa-map-marker-alt icon-map-marker"></i></label>
        <select id="filterRegion">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>
          <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        </select>
      </div>
    </div>

    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…..." oninput="searchDonors()">
      <button style="padding: 8px 12px;"><i class="fas fa-search icon-search"></i></button>
    </div>
    
    <table id="donorsTable">
      <thead>
        <tr>
          <th class="hidden-column">#</th>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th class="hidden-column">Ø§Ù„Ø¬Ù†Ø³</th>
          <th class="hidden-column">Ø§Ù„Ø¹Ù…Ø±</th>
          <th>ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…</th>
          <th class="hidden-column">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th>
          <th class="hidden-column">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
          <th class="hidden-column">Ø§Ù„Ø¬ÙˆØ§Ù„ 1</th>
          <th class="hidden-column">Ø§Ù„Ø¬ÙˆØ§Ù„ 2</th>
          <th class="hidden-column">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
          <th class="hidden-column">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="donorsList"></tbody>
    </table>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ -->
  <div id="donorModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalDonorName"></div>
        <button class="close-btn" onclick="closeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="modal-field">
          <div class="modal-label">Ø§Ù„Ø¬Ù†Ø³ <i class="fas fa-venus-mars icon-venus-mars"></i></div>
          <div class="modal-value" id="modalGender"></div>
        </div>
        <div class="modal-field">
          <div class="modal-label">Ø§Ù„Ø¹Ù…Ø± <i class="fas fa-birthday-cake icon-birthday"></i></div>
          <div class="modal-value" id="modalAge"></div>
        </div>
        <div class="modal-field">
          <div class="modal-label">ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù… <i class="fas fa-tint icon-tint"></i></div>
          <div class="modal-value" id="modalBloodType"></div>
        </div>
        <div class="modal-field">
          <div class="modal-label">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© <i class="fas fa-map-marker-alt icon-map-marker"></i></div>
          <div class="modal-value" id="modalGovernorate"></div>
        </div>
        <div class="modal-field">
          <div class="modal-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© <i class="fas fa-map-marker-alt icon-map-marker"></i></div>
          <div class="modal-value" id="modalRegion"></div>
        </div>
        <div class="modal-field" style="grid-column: span 2;">
          <div class="modal-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <i class="fas fa-address-card icon-address-card"></i></div>
          <div class="modal-value" id="modalAddress"></div>
        </div>
        <div class="modal-field">
          <div class="modal-label">Ø§Ù„Ø¬ÙˆØ§Ù„ 1 <i class="fas fa-mobile-alt icon-mobile"></i></div>
          <div class="phone-container">
            <div class="modal-value" id="modalPhone1"></div>
            <button class="call-btn" id="callPhone1Btn" onclick="callPhone('phone1')">
              <i class="fas fa-phone icon-phone"></i>
            </button>
          </div>
        </div>
        <div class="modal-field">
          <div class="modal-label">Ø§Ù„Ø¬ÙˆØ§Ù„ 2 <i class="fas fa-mobile-alt icon-mobile"></i></div>
          <div class="phone-container">
            <div class="modal-value" id="modalPhone2"></div>
            <button class="call-btn" id="callPhone2Btn" onclick="callPhone('phone2')" style="display: none;">
              <i class="fas fa-phone icon-phone"></i>
            </button>
          </div>
        </div>
        <div class="modal-field" style="grid-column: span 2;">
          <div class="modal-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª <i class="fas fa-sticky-note icon-sticky-note"></i></div>
          <div class="modal-value" id="modalNotes"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const firebaseConfig = {
      databaseURL: "https://chat-fat-free-default-rtdb.firebaseio.com/"
    };
    
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    try {
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
        console.log('âœ… Firebase initialized successfully');
      }
    } catch (error) {
      console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:", error);
    }
    
    const db = firebase.database();

    const DONORS_DB_URL = "https://chat-fat-free-default-rtdb.firebaseio.com/fah/categories/merchant_bdyh_lmshwr_1762375576678_78/blood_donors.json";

    let donorsData = {};
    let marqueeIndex = 0;
    let currentDonorData = {};
    let allGovernorates = [];
    let allRegions = [];
    let regionsData = {};

    const marqueeTexts = [
      'Ù‚Ø§Ù„ ØªØ¹Ø§Ù„Ù‰ ï´¿ÙˆÙÙ…ÙÙ†Ù’ Ø£ÙØ­Ù’ÙŠÙØ§Ù‡ÙØ§ ÙÙÙƒÙØ£ÙÙ†Ù‘ÙÙ…ÙØ§ Ø£ÙØ­Ù’ÙŠÙØ§ Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù Ø¬ÙÙ…ÙÙŠØ¹Ù‹Ø§ï´¾  Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©: 32',
      'Ù‚Ø§Ù„ Ø§Ù„Ù†Ø¨ÙŠ ï·º "Ù…Ù† ÙØ±Ù‘Ø¬ Ø¹Ù† Ù…Ø³Ù„Ù… ÙƒØ±Ø¨Ø©Ù‹ Ù…Ù† ÙƒÙØ±ÙØ¨ Ø§Ù„Ø¯Ù†ÙŠØ§ ÙØ±Ù‘Ø¬ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡ ÙƒØ±Ø¨Ø©Ù‹ Ù…Ù† ÙƒÙØ±ÙØ¨ ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø©" (Ø±ÙˆØ§Ù‡ Ù…Ø³Ù„Ù…)',
      'Ø§Ù„ØªØ¨Ø±Ø¹ Ø¨Ø§Ù„Ø¯Ù… Ø¹Ù…Ù„ Ø¥Ù†Ø³Ø§Ù†ÙŠ Ø¹Ø¸ÙŠÙ… ÙˆØ£Ø¬Ø±Ù‡ ÙƒØ¨ÙŠØ±ØŒ ÙˆÙ‡Ùˆ Ù…Ù† Ø¨Ø§Ø¨ Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ù†ÙØ³ ÙˆØ§Ù„Ø¥Ø­Ø³Ø§Ù† Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù„Ù‚ØŒ ÙˆÙŠØ¹Ø¯ ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© Ù…Ø§ Ø¯Ø§Ù… Ø§Ù„Ø¯Ù… ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø¥Ù†Ù‚Ø§Ø° Ø­ÙŠØ§Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†',
      'Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù‡Ø¯Ø§Ø¡ Ø¥Ù„Ù‰ Ø±ÙˆØ­ ÙˆØ§Ù„Ø¯ÙŠ Ø§Ù„Ù…Ù†ØªÙ‚Ù„ Ø§Ù„Ù‰ Ø±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ Ø§Ù„ÙˆØ§Ù„Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø°Ù…Ø§Ø±ÙŠ'
    ];

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    function showTab(index) {
      document.querySelectorAll('.tab').forEach((tab, i) => {
        tab.classList.toggle('active', i === index);
        document.querySelectorAll('.tab-content')[i].classList.toggle('active', i === index);
      });
      if (index === 1) {
        loadDonors();
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ù…Ù† Firebase
    async function loadGovernoratesAndRegions() {
      try {
        console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚...');
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª
        const governoratesSnapshot = await db.ref("governorates").once("value");
        const governoratesData = governoratesSnapshot.val();
        
        if (governoratesData) {
          allGovernorates = Object.entries(governoratesData).map(([id, data]) => ({
            id: id,
            name: data.name || data.id,
            areas: data.areas || {}
          }));
          
          console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª:', allGovernorates.length);
          
          // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          const governorateSelect = document.getElementById('governorate');
          const filterGovernorateSelect = document.getElementById('filterGovernorate');
          
          governorateSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>';
          filterGovernorateSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>';
          
          allGovernorates.forEach(gov => {
            const option = document.createElement('option');
            option.value = gov.id;
            option.textContent = gov.name;
            governorateSelect.appendChild(option);
            
            const filterOption = document.createElement('option');
            filterOption.value = gov.id;
            filterOption.textContent = gov.name;
            filterGovernorateSelect.appendChild(filterOption);
          });
          
          // Ø¨Ù†Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
          regionsData = {};
          allGovernorates.forEach(gov => {
            if (gov.areas && typeof gov.areas === 'object') {
              regionsData[gov.id] = Object.values(gov.areas);
            }
          });
          
          console.log('ğŸ—ºï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ø­Ù…Ù„Ø©:', regionsData);
        } else {
          console.warn('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
          loadDefaultGovernorates();
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª:', error);
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        loadDefaultGovernorates();
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚
    function loadDefaultGovernorates() {
      console.log('ğŸ”„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª...');
      
      allGovernorates = [
        { id: "sanaa", name: "ØµÙ†Ø¹Ø§Ø¡", areas: ["Ø§Ù„Ø±ÙˆØ¶Ø©", "Ø§Ù„ØªØ­Ø±ÙŠØ±", "Ø§Ù„Ø³Ø¨Ø¹ÙŠÙ†", "Ø§Ù„ÙˆØ­Ø¯Ø©", "Ù…Ø¹ÙŠÙ†"] },
        { id: "aden", name: "Ø¹Ø¯Ù†", areas: ["Ø®ÙˆØ± Ù…ÙƒØ³Ø±", "Ø§Ù„ØªÙˆØ§Ù‡ÙŠ", "Ø§Ù„Ù…Ø¹Ù„Ø§", "Ø§Ù„Ø´ÙŠØ® Ø¹Ø«Ù…Ø§Ù†"] },
        { id: "taiz", name: "ØªØ¹Ø²", areas: ["Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©", "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "ØµØ§Ù„Ø©", "Ø§Ù„Ù…Ø¸ÙØ±"] },
        { id: "hodeidah", name: "Ø§Ù„Ø­Ø¯ÙŠØ¯Ø©", areas: ["Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡", "Ø§Ù„Ø­Ø§Ù„ÙŠ", "Ø§Ù„Ù†Ø®ÙŠÙ„", "Ø§Ù„Ø­ÙˆÙƒ"] }
      ];
      
      const governorateSelect = document.getElementById('governorate');
      const filterGovernorateSelect = document.getElementById('filterGovernorate');
      
      governorateSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>';
      filterGovernorateSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>';
      
      allGovernorates.forEach(gov => {
        const option = document.createElement('option');
        option.value = gov.id;
        option.textContent = gov.name;
        governorateSelect.appendChild(option);
        
        const filterOption = document.createElement('option');
        filterOption.value = gov.id;
        filterOption.textContent = gov.name;
        filterGovernorateSelect.appendChild(filterOption);
      });
      
      // Ø¨Ù†Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
      regionsData = {};
      allGovernorates.forEach(gov => {
        regionsData[gov.id] = gov.areas;
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    function updateRegions() {
      const governorateId = document.getElementById('governorate').value;
      const regionSelect = document.getElementById('region');
      
      regionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>';
      
      if (governorateId && regionsData[governorateId]) {
        regionsData[governorateId].forEach(region => {
          const option = document.createElement('option');
          option.value = region;
          option.textContent = region;
          regionSelect.appendChild(option);
        });
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙÙŠ ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø«
    function updateFilterRegions() {
      const governorateId = document.getElementById('filterGovernorate').value;
      const regionSelect = document.getElementById('filterRegion');
      
      regionSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>';
      
      if (governorateId && regionsData[governorateId]) {
        regionsData[governorateId].forEach(region => {
          const option = document.createElement('option');
          option.value = region;
          option.textContent = region;
          regionSelect.appendChild(option);
        });
      }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ù
    function getGovernorateName(governorateId) {
      const gov = allGovernorates.find(g => g.id === governorateId);
      return gov ? gov.name : governorateId;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
    function validatePhone(phone) {
      if (!phone) return false;
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ù‚Ù… ÙŠØªÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
      const phoneRegex = /^\d{9}$/;
      return phoneRegex.test(phone);
    }

    // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ­Ø±Ùƒ
    function changeMarqueeText() {
      const marqueeElement = document.getElementById('marqueeText');
      marqueeElement.style.animation = 'none';
      setTimeout(() => {
        marqueeElement.textContent = marqueeTexts[marqueeIndex];
        marqueeElement.style.animation = 'marquee 40s linear infinite';
      }, 10);
      marqueeIndex = (marqueeIndex + 1) % marqueeTexts.length;
    }

    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ† Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
    async function fetchDonors() {
      try {
        const res = await fetch(DONORS_DB_URL);
        donorsData = await res.json() || {};
      } catch (error) {
        console.error('Error fetching donors:', error);
        donorsData = {};
      }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø³Ù…
    function validateName(name) {
      const nameParts = name.split(' ').filter(part => part.length > 0);
      return nameParts.length >= 3;
    }

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
    function showError(fieldId, errorId, show) {
      const field = document.getElementById(fieldId);
      const error = document.getElementById(errorId);
      
      if (show) {
        field.classList.add('error');
        error.style.display = 'block';
      } else {
        field.classList.remove('error');
        error.style.display = 'none';
      }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    function validateForm() {
      let isValid = true;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù…
      const donorName = document.getElementById('donorName').value.trim();
      if (!validateName(donorName)) {
        showError('donorName', 'nameError', true);
        isValid = false;
      } else {
        showError('donorName', 'nameError', false);
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù†Ø³
      const gender = document.getElementById('gender').value;
      if (!gender) {
        showError('gender', 'genderError', true);
        isValid = false;
      } else {
        showError('gender', 'genderError', false);
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…
      const bloodType = document.getElementById('bloodType').value.trim();
      if (!bloodType) {
        showError('bloodType', 'bloodTypeError', true);
        isValid = false;
      } else {
        showError('bloodType', 'bloodTypeError', false);
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
      const governorate = document.getElementById('governorate').value;
      if (!governorate) {
        showError('governorate', 'governorateError', true);
        isValid = false;
      } else {
        showError('governorate', 'governorateError', false);
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
      const region = document.getElementById('region').value;
      if (!region) {
        showError('region', 'regionError', true);
        isValid = false;
      } else {
        showError('region', 'regionError', false);
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ 1
      const phone1 = document.getElementById('phone1').value.trim();
      if (!validatePhone(phone1)) {
        showError('phone1', 'phone1Error', true);
        isValid = false;
      } else {
        showError('phone1', 'phone1Error', false);
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ 2 (Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡)
      const phone2 = document.getElementById('phone2').value.trim();
      if (phone2 && !validatePhone(phone2)) {
        showError('phone2', 'phone2Error', true);
        isValid = false;
      } else {
        showError('phone2', 'phone2Error', false);
      }
      
      return isValid;
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    document.getElementById('donorForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!validateForm()) {
        return;
      }
      
      await fetchDonors();

      const donorName = document.getElementById('donorName').value.trim();
      const phone1 = document.getElementById('phone1').value.trim();
      const phone2 = document.getElementById('phone2').value.trim();
      const gender = document.getElementById('gender').value;
      const bloodType = document.getElementById('bloodType').value.trim().toUpperCase();
      const governorate = document.getElementById('governorate').value;
      const governorateName = getGovernorateName(governorate);
      const region = document.getElementById('region').value;

      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±
      for (const id in donorsData) {
        const d = donorsData[id];
        if (d.donorName === donorName) {
          alert("âš ï¸ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø®Ù„ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯.");
          return;
        }
        if (d.phone1 === phone1) {
          alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ 1 Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯.");
          return;
        }
        if (phone2 && d.phone2 === phone2) {
          alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ 2 Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯.");
          return;
        }
      }

      const donor = {
        donorName,
        gender,
        age: document.getElementById('age').value,
        bloodType,
        governorate: governorateName, // Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
        governorateId: governorate, // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù„Ù„ÙÙ„ØªØ±Ø©
        region,
        address: document.getElementById('address').value,
        phone1,
        phone2: phone2 || '', // Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ 2 ÙÙ‚Ø· Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡
        notes: document.getElementById('notes').value,
        createdAt: new Date().toISOString()
      };

      try {
        const response = await fetch(DONORS_DB_URL.replace(".json", "") + ".json", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(donor)
        });

        if (response.ok) {
          alert("âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ Ø¨Ù†Ø¬Ø§Ø­");
          document.getElementById('donorForm').reset();
          fetchDonors();
          loadDonors(); // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†
        } else {
          alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
        }
      } catch (error) {
        console.error('Error saving donor:', error);
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
      }
    });

    // ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†
    async function loadDonors() {
      try {
        const res = await fetch(DONORS_DB_URL);
        donorsData = await res.json() || {};
        const tbody = document.getElementById('donorsList');
        tbody.innerHTML = "";
        
        if (Object.keys(donorsData).length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="12" style="text-align: center; padding: 20px; color: #666;">
                <i class="fas fa-info-circle" style="color: #3498db;"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ¨Ø±Ø¹ÙŠÙ† Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
              </td>
            </tr>
          `;
          return;
        }
        
        let counter = 1;
        for (const id in donorsData) {
          const d = donorsData[id];
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="hidden-column">${counter++}</td>
            <td>${d.donorName || ''}</td>
            <td class="hidden-column">${d.gender || ''}</td>
            <td class="hidden-column">${d.age || ''}</td>
            <td>${d.bloodType || ''}</td>
            <td class="hidden-column">${d.governorate || ''}</td>
            <td class="hidden-column">${d.region || ''}</td>
            <td class="hidden-column">${d.phone1 || ''}</td>
            <td class="hidden-column">${d.phone2 || ''}</td>
            <td class="hidden-column">${d.address || ''}</td>
            <td class="hidden-column">${d.notes || ''}</td>
            <td><button class="view-btn" onclick="showDonorDetails('${id}')"><i class="fas fa-eye icon-eye"></i> Ø¹Ø±Ø¶</button></td>
          `;
          tbody.appendChild(tr);
        }
        window.donorsData = donorsData;
      } catch (error) {
        console.error('Error loading donors:', error);
        const tbody = document.getElementById('donorsList');
        tbody.innerHTML = `
          <tr>
            <td colspan="12" style="text-align: center; padding: 20px; color: #e74c3c;">
              <i class="fas fa-exclamation-triangle"></i> Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </td>
          </tr>
        `;
      }
    }

    // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙØµÙŠÙ„Ø© Ù…Ø¹ Ø§Ù„ÙÙ„Ø§ØªØ±
    function searchDonors() {
      const term = document.getElementById('searchInput').value.toLowerCase();
      const filterGovernorate = document.getElementById('filterGovernorate').value;
      const filterRegion = document.getElementById('filterRegion').value;
      
      const tbody = document.getElementById('donorsList');
      tbody.innerHTML = "";
      let counter = 1;
      
      let hasResults = false;
      
      for (const id in window.donorsData || {}) {
        const d = window.donorsData[id];
        
        // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
        if (filterGovernorate && d.governorateId !== filterGovernorate) {
          continue;
        }
        
        // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
        if (filterRegion && d.region !== filterRegion) {
          continue;
        }
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ
        if (
          (d.donorName && d.donorName.toLowerCase().includes(term)) ||
          (d.bloodType && d.bloodType.toLowerCase().includes(term)) ||
          (d.governorate && d.governorate.toLowerCase().includes(term)) ||
          (d.region && d.region.toLowerCase().includes(term)) ||
          (d.address && d.address.toLowerCase().includes(term))
        ) {
          hasResults = true;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="hidden-column">${counter++}</td>
            <td>${d.donorName}</td>
            <td class="hidden-column">${d.gender || ''}</td>
            <td class="hidden-column">${d.age || ''}</td>
            <td>${d.bloodType}</td>
            <td class="hidden-column">${d.governorate || ''}</td>
            <td class="hidden-column">${d.region || ''}</td>
            <td class="hidden-column">${d.phone1}</td>
            <td class="hidden-column">${d.phone2 || ''}</td>
            <td class="hidden-column">${d.address || ''}</td>
            <td class="hidden-column">${d.notes || ''}</td>
            <td><button class="view-btn" onclick="showDonorDetails('${id}')"><i class="fas fa-eye icon-eye"></i> Ø¹Ø±Ø¶</button></td>
          `;
          tbody.appendChild(tr);
        }
      }
      
      if (!hasResults) {
        tbody.innerHTML = `
          <tr>
            <td colspan="12" style="text-align: center; padding: 20px; color: #666;">
              <i class="fas fa-search icon-search"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«
            </td>
          </tr>
        `;
      }
    }

    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØªØ¨Ø±Ø¹ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
    function showDonorDetails(donorId) {
      const donor = window.donorsData[donorId];
      currentDonorData = donor;
      
      document.getElementById('modalDonorName').textContent = donor.donorName || '';
      document.getElementById('modalGender').textContent = donor.gender || '';
      document.getElementById('modalAge').textContent = donor.age || '';
      document.getElementById('modalBloodType').textContent = donor.bloodType || '';
      document.getElementById('modalGovernorate').textContent = donor.governorate || '';
      document.getElementById('modalRegion').textContent = donor.region || '';
      document.getElementById('modalAddress').textContent = donor.address || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù†ÙˆØ§Ù†';
      document.getElementById('modalPhone1').textContent = donor.phone1 || '';
      document.getElementById('modalPhone2').textContent = donor.phone2 || '';
      document.getElementById('modalNotes').textContent = donor.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª';
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„Ø¬ÙˆØ§Ù„ 2
      const callPhone2Btn = document.getElementById('callPhone2Btn');
      if (donor.phone2 && donor.phone2.trim() !== '') {
        callPhone2Btn.style.display = 'flex';
      } else {
        callPhone2Btn.style.display = 'none';
      }
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
      document.getElementById('donorModal').style.display = 'flex';
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
    function closeModal() {
      document.getElementById('donorModal').style.display = 'none';
    }

    // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø±Ù‚Ù…
    function callPhone(phoneType) {
      const phoneNumber = currentDonorData[phoneType];
      if (phoneNumber) {
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ù‚Ù… Ù…Ù† Ø£ÙŠ Ù…Ø³Ø§ÙØ§Øª Ø£Ùˆ Ø£Ø­Ø±Ù ØºÙŠØ± Ø±Ù‚Ù…ÙŠØ©
        const cleanNumber = phoneNumber.replace(/\D/g, '');
        window.open(`tel:${cleanNumber}`, '_self');
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
      // ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
      showTab(1);
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø£ÙˆÙ„Ø§Ù‹
      loadGovernoratesAndRegions();
      
      // Ø«Ù… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†
      fetchDonors().then(() => {
        loadDonors();
      });
      
      // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ­Ø±Ùƒ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†
      setInterval(changeMarqueeText, 10000);
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ØªØ­Ù‚Ù‚ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
      document.getElementById('donorName').addEventListener('input', function() {
        showError('donorName', 'nameError', !validateName(this.value.trim()));
      });
      
      document.getElementById('gender').addEventListener('change', function() {
        showError('gender', 'genderError', !this.value);
      });
      
      document.getElementById('bloodType').addEventListener('input', function() {
        showError('bloodType', 'bloodTypeError', !this.value.trim());
      });
      
      document.getElementById('governorate').addEventListener('change', function() {
        showError('governorate', 'governorateError', !this.value);
      });
      
      document.getElementById('region').addEventListener('change', function() {
        showError('region', 'regionError', !this.value);
      });
      
      document.getElementById('phone1').addEventListener('input', function() {
        showError('phone1', 'phone1Error', !validatePhone(this.value.trim()));
      });
      
      document.getElementById('phone2').addEventListener('input', function() {
        if (this.value.trim()) {
          showError('phone2', 'phone2Error', !validatePhone(this.value.trim()));
        } else {
          showError('phone2', 'phone2Error', false);
        }
      });
    });
  </script>

</body>
</html>
