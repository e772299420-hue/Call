<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZ السوق الشامل - الموقع الرسمي</title>
    <meta name="description" content="موقع AZ السوق الشامل لعرض وطلب المنتجات والخدمات في جميع أنحاء اليمن. تسوق إلكتروني، عقارات، وظائف، توصيل طلبات، خدمات متكاملة.">
    <meta name="keywords" content="AZ السوق الشامل, az السوق الشامل, azsouk, az al souq al shamel, سوق شامل, تسوق إلكتروني, تسوق اونلاين, online shopping, سوق اليمن, yemen market, عقارات اليمن, yemen real estate, وظائف اليمن, yemen jobs, توصيل طلبات, delivery service, خدمات اليمن, yemen services, سوق مستعمل, حراج اليمن, سوق تجاري, commercial market, منصة تسوق, shopping platform, متجر الكتروني, online store, AZ market, AZ souq, سوق AZ, ماروان الذماري, المميز سوفت, تطبيق تسوق يمني, منصة تجارية يمنية, تسوق عبر الإنترنت في اليمن, خدمات يمنية شاملة, سوق الكتروني يمني, أفضل منصة تسوق في اليمن, متجر يمني متكامل, دليل خدمات اليمن, منصة عقارات يمنية, وظائف شاغرة في اليمن, توصيل سريع في اليمن, حراج اليمن الإلكتروني, سوق اليمن المستعمل, خدمات طلبات اليمن, دليل تجاري يمني, سوق شامل يمني, تطبيقات يمنية, خدمات رقمية يمنية, اقتصاد يمني, تجارة إلكترونية يمنية, مشاريع يمنية, استثمار في اليمن, دعم الأعمال اليمنية">
    <meta name="author" content="AZ السوق الشامل">
    <meta name="google-site-verification" content="Py26cVMd571vmKQo4rbXGAKTvCgiuTym5A9JfBGFqZQ" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/Call/manifest.json?v=2">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AZ السوق الشامل">
    <link rel="apple-touch-icon" href="https://github.com/e772299420-hue/Call/blob/main/icon-512x512.png?raw=true&v=2">
    <link rel="icon" type="image/png" href="https://github.com/e772299420-hue/Call/blob/main/icon-512x512.png?raw=true&v=2">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- إعلانات AMP -->
    <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js"></script>
    
<style>
:root {
    --primary-color: #3498db;
    --secondary-color: #2980b9;
    --accent-color: #e74c3c;
    --light-color: #ecf0f1;
    --dark-color: #2c3e50;
    --welcome-color: #27ae60;
    --warning-color: #f39c12;
    --danger-color: #e74c3c;
    --restaurant-color: #e67e22;
    --text-dark: #1a1a1a;
}

* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

body {
    background: linear-gradient(135deg, #f5f7fa 0%, #e3e9f7 100%);
    color:#333; padding:20px; min-height:100vh;
    display:flex; flex-direction:column; align-items:center;
    overflow-x:hidden; position:relative;
    padding-bottom: 50px;
    font-size: 18px;
}

/* إخفاء مؤشرات الحالة */
.status-bar {
    display: none;
}

/* شريط الهيدر الموسع والمحسن */
.header {
    background: rgba(255,255,255,0.95); 
    backdrop-filter: blur(15px);
    padding:0; 
    display:flex; 
    justify-content:center; 
    align-items:center;
    border-radius:25px; 
    box-shadow:0 15px 40px rgba(0,0,0,0.25);
    position:sticky; 
    top:20px; 
    z-index:100; 
    margin-bottom:30px;
    width:100%; 
    max-width:none;
    height: 180px; /* زيادة الارتفاع */
    border:3px solid rgba(52, 152, 219, 0.4);
    opacity: 0;
    transform: translateY(-100px) scale(0.8);
    overflow: hidden;
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.header:hover {
    box-shadow:0 20px 50px rgba(0,0,0,0.35);
    border-color: rgba(52, 152, 219, 0.6);
    transform: translateY(-5px);
}

.header-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 22px;
    transition: all 0.5s ease;
    filter: brightness(1.05) contrast(1.1);
}

.header:hover .header-image {
    transform: scale(1.02);
    filter: brightness(1.1) contrast(1.15);
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, 
        rgba(52, 152, 219, 0.1) 0%, 
        transparent 50%, 
        rgba(231, 76, 60, 0.1) 100%);
    z-index: 1;
    border-radius: 22px;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.header:hover::before {
    opacity: 1;
}

.app-name {
    display: none;
}

.logo-container {
    display: none;
}

.logo-header {
    display: none;
}

.logo-ghost-right {
    display: none;
}

.logo-ghost-left {
    display: none;
}

@keyframes logoFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(5deg); }
}

@keyframes ghostMoveRight {
    0%, 100% { 
        transform: translateX(0px) translateY(0px) scale(0.8);
        opacity: 0.2;
    }
    25% { 
        transform: translateX(40px) translateY(-5px) scale(0.9);
        opacity: 0.4;
    }
    50% { 
        transform: translateX(20px) translateY(5px) scale(1);
        opacity: 0.3;
    }
    75% { 
        transform: translateX(60px) translateY(-3px) scale(0.95);
        opacity: 0.35;
    }
}

@keyframes ghostMoveLeft {
    0%, 100% { 
        transform: translateX(0px) translateY(0px) scale(0.8);
        opacity: 0.2;
    }
    25% { 
        transform: translateX(-40px) translateY(-5px) scale(0.9);
        opacity: 0.4;
    }
    50% { 
        transform: translateX(-20px) translateY(5px) scale(1);
        opacity: 0.3;
    }
    75% { 
        transform: translateX(-60px) translateY(-3px) scale(0.95);
        opacity: 0.35;
    }
}

.logo-header:hover {
    transform: scale(1.2) rotate(15deg);
    box-shadow: 0 0 30px rgba(52, 152, 219, 1);
    filter: brightness(1.2);
}

.container {
    display:grid; grid-template-columns:repeat(auto-fit, minmax(320px,1fr));
    gap:30px; margin-bottom:40px; width:95%; max-width:1200px;
}

.box {
    background: rgba(255,255,255,0.95);
    border-radius:25px;
    padding:20px;
    box-shadow:0 15px 35px rgba(0,0,0,0.15);
    transition:all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    display:flex; flex-direction:column; align-items:center;
    opacity:0;
    transform:translateY(100px) rotateX(45deg);
    border:3px solid var(--primary-color);
    min-height: 260px;
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
}

.box::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.8s;
}

.box:hover::before {
    left: 100%;
}

.box:hover {
    transform:translateY(-15px) rotateX(0deg) scale(1.03);
    box-shadow:0 25px 50px rgba(0,0,0,0.25);
    border-color: var(--primary-color);
}

.box-title {
    text-align:center; margin-bottom:15px; padding-bottom:10px;
    border-bottom:3px solid transparent;
    background: none;
    border-image: none;
    color: var(--accent-color);
    font-size:26px; width:100%; cursor:pointer;
    font-weight: bold;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    position: relative;
}

.box-title::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 50%;
    width: 0;
    height: 3px;
    background: var(--accent-color);
    transition: all 0.5s ease;
    transform: translateX(-50%);
}

.box-title:hover::after {
    width: 100%;
}

.buttons-grid {
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:12px;
    width:100%;
}

.btn {
    display:flex; align-items:center; justify-content:flex-start;
    padding:12px 15px;
    background: rgba(255,255,255,0.9);
    color: var(--text-dark); border:none; border-radius:12px; cursor:pointer;
    font-size:16px; font-weight:700;
    transition:all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    text-align:right;
    height:50px !important;
    opacity:0; transform:scale(0) rotate(180deg);
    box-shadow:0 5px 15px rgba(52, 152, 219, 0.2);
    text-shadow:0 1px 2px rgba(0,0,0,0.1);
    text-decoration: none;
    position: relative;
    overflow: hidden;
    border: 2px solid var(--primary-color);
    width: 100%;
}

.btn:hover {
    transform:translateY(-5px) scale(1.05) rotate(0deg);
    box-shadow:0 10px 20px rgba(52, 152, 219, 0.3);
    background: rgba(52, 152, 219, 0.1);
    color: var(--text-dark);
}

.btn:hover i {
    transform: scale(1.1) rotate(10deg);
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

.btn i {
    font-size:18px;
    filter:drop-shadow(0 1px 2px rgba(0,0,0,0.2));
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    min-width: 20px;
    text-align: center;
    color: var(--primary-color);
}

.btn-text {
    font-size:14px;
    text-align:right;
    line-height:1.3;
    font-weight:600;
    color: var(--text-dark);
    flex: 1;
}

.btn-description {
    font-size: 11px;
    color: #ff0000; /* تغيير اللون إلى الأحمر */
    margin-top: 3px;
    font-weight: normal;
    line-height: 1.2;
    display: block;
    width: 100%;
}

/* إضافة الصور للزر - تم التعديل */
.btn-image-container {
    position: relative;
    width: 20px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 15px;
    flex-shrink: 0;
}
/*مروان*/
.btn-image {
    width: 60px;
    height: 60px;
    border-radius: 15px;
    object-fit: cover;
    border: 0px solid var(--primary-color);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    background-color: rgba(255, 255, 255, 0.9);
    padding: 1px;
}

.btn:hover .btn-image {
    transform: scale(1.1);
    border-color: var(--secondary-color);
    box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
}

.install-btn, .meal-order-btn {
    grid-column: span 1 !important;
    height: 50px !important;
}

.install-btn::after, .meal-order-btn::after {
    display: none;
}

/* زر القائمة المنسدلة - تم التعديل */
.menu-btn {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 12px;
    padding: 12px 15px;
    background: rgba(255,255,255,0.9);
    color: var(--text-dark);
    border: 2px solid var(--primary-color);
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 700;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    margin-top: 12px;
    width: 100%;
    height: 50px;
}

.menu-btn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
    background: rgba(52, 152, 219, 0.1);
}

.menu-btn i {
    font-size: 20px;
    color: var(--primary-color);
    position: relative;
}

.menu-dropdown {
    display: none;
    position: relative;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    margin-top: 8px;
    padding: 12px;
    z-index: 10;
    animation: fadeIn 0.3s ease;
    border: 2px solid var(--primary-color);
}

.menu-dropdown.show {
    display: block;
}

.menu-item {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 12px;
    padding: 12px 15px;
    margin-bottom: 8px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
}

.menu-item:hover {
    background: rgba(52, 152, 219, 0.1);
    color: var(--primary-color);
    transform: translateX(5px);
    border: 1px solid var(--primary-color);
}

.menu-item:last-child {
    margin-bottom: 0;
}

.menu-item i {
    font-size: 16px;
    width: 20px;
    text-align: center;
    color: var(--primary-color);
}

/* عداد التجار */
.merchant-counter-badge {
    position: absolute;
    top: -8px;
    left: -8px;
    background: var(--primary-color);
    color: white;
    border-radius: 20px;
    padding: 3px 8px;
    font-size: 0.7rem;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    animation: pulse 2s infinite;
    white-space: nowrap;
    z-index: 10;
    min-width: 20px;
    text-align: center;
}

/* زر تثبيت التطبيق العائم */
.floating-install-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: rgba(52, 152, 219, 0.9);
    color: white;
    border: 2px solid var(--primary-color);
    border-radius: 50px;
    padding: 12px 20px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.5);
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    font-size: 16px;
}

.floating-install-btn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 12px 30px rgba(52, 152, 219, 0.7);
    background: var(--primary-color);
}

.floating-install-btn.hidden {
    display: none !important;
}

/* زر العرض العائم - تم تعديله ليظهر أعلى يسار الشاشة */
.floating-display-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: rgba(52, 152, 219, 0.9);
    color: white;
    border: 2px solid var(--primary-color);
    border-radius: 50px;
    padding: 12px 20px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.5);
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    font-size: 16px;
}

.floating-display-btn:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 12px 30px rgba(52, 152, 219, 0.7);
    background: var(--primary-color);
}

.floating-display-btn:focus {
    outline: 3px solid rgba(52, 152, 219, 0.5);
    outline-offset: 2px;
}

/* حاوية الإشعارات العلوية */
.notification-top-container {
    position: fixed;
    top: 80px;
    left: 0;
    right: 0;
    z-index: 999;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding: 0 20px;
    pointer-events: none;
}

.toast-top {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(15px);
    border-radius: 12px;
    padding: 15px 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    border-left: 4px solid var(--primary-color);
    display: flex;
    align-items: center;
    gap: 12px;
    max-width: 400px;
    width: 100%;
    animation: slideDown 0.3s ease;
    pointer-events: auto;
}

.toast-top.success {
    border-left-color: var(--welcome-color);
    background: rgba(39, 174, 96, 0.1);
}

.toast-top.error {
    border-left-color: var(--danger-color);
    background: rgba(231, 76, 60, 0.1);
}

.toast-top.info {
    border-left-color: var(--primary-color);
    background: rgba(52, 152, 219, 0.1);
}

.toast-top .toast-content {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}

.toast-top .toast-close {
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.toast-top .toast-close:hover {
    background: rgba(0,0,0,0.1);
    color: #000;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* شاشة تسجيل الدخول للإدارة */
.login-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); display: none; justify-content: center;
    align-items: center; z-index: 2000; backdrop-filter: blur(10px);
    animation: fadeIn 0.6s ease;
}

.login-modal.show { display: flex; }

.login-container {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 20px; padding: 40px;
    width: 90%; max-width: 450px; box-shadow: 0 20px 50px rgba(0,0,0,0.4);
    position: relative;
    animation: modalSlideIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border: 2px solid var(--primary-color);
    font-size: 18px;
}

.login-header { text-align: center; margin-bottom: 30px; }

.login-logo {
    display: flex; align-items: center; justify-content: center;
    gap: 15px; margin-bottom: 20px;
}

.login-logo i {
    font-size: 50px;
    color: var(--primary-color);
    animation: logoRotate 4s ease-in-out infinite;
}

@keyframes logoRotate {
    0%, 100% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(10deg) scale(1.1); }
}

.login-logo span {
    font-size: 32px; font-weight: bold;
    color: var(--primary-color);
}

.login-title { font-size: 32px; color: var(--primary-color); margin-bottom: 8px; font-weight: bold; }
.login-subtitle { color: #666; font-size: 20px; }

.form-group { margin-bottom: 25px; position: relative; }
.form-group label {
    display: block; margin-bottom: 10px; font-weight: bold; color: var(--primary-color);
    font-size: 18px;
}
.form-group input {
    width: 100%; padding: 15px 18px; border: 2px solid #ddd;
    border-radius: 12px; font-size: 18px;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    background: rgba(255,255,255,0.9);
}
.form-group input:focus {
    border-color: var(--primary-color); outline: none;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
    transform: scale(1.02);
}

.password-toggle {
    position: absolute; left: 18px; top: 52px; cursor: pointer;
    color: var(--primary-color); font-size: 20px;
    transition: all 0.3s ease;
}

.password-toggle:hover {
    color: var(--secondary-color); transform: scale(1.1);
}

.login-btn {
    display: block; width: 100%;
    background: var(--primary-color);
    color: white; padding: 15px; border-radius: 12px; border: none;
    font-size: 22px; font-weight: bold; cursor: pointer;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    margin-top: 15px; position: relative; overflow: hidden;
    border: 2px solid var(--primary-color);
}

.login-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255,255,255,0.3);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: all 0.6s ease;
}

.login-btn:hover::before {
    width: 400px;
    height: 400px;
}

.login-btn:hover {
    background: var(--secondary-color);
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
}

.login-btn:disabled {
    background: #ccc; cursor: not-allowed; transform: none;
    box-shadow: none;
}

.login-message {
    margin-top: 25px; padding: 15px; border-radius: 10px;
    text-align: center; display: none; animation: fadeIn 0.6s ease;
    font-weight: bold;
    font-size: 18px;
}

.error-message {
    background: linear-gradient(135deg, #ffebee, #ffcdd2);
    color: #d32f2f; border: 2px solid #d32f2f;
}
.success-message {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    color: #388e3c; border: 2px solid #388e3c;
}

.close-btn {
    position: absolute; top: 15px; right: 15px; background: none;
    border: none; font-size: 2rem; color: #666; cursor: pointer;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    width: 40px; height: 40px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
}

.close-btn:hover {
    color: var(--primary-color); transform: rotate(90deg) scale(1.1);
    background: rgba(52, 152, 219, 0.1);
}

.loading-spinner {
    display: inline-block; width: 20px; height: 20px;
    border: 3px solid rgba(255,255,255,.3); border-radius: 50%;
    border-top-color: #fff; animation: spin 1s ease-in-out infinite; margin-left: 10px;
}

/* إشعار زر طلب الانضمام */
.join-notification {
    position: absolute;
    top: 15px;
    left: 15px;
    background: var(--primary-color);
    color: white;
    border-radius: 20px;
    padding: 5px 12px;
    font-size: 0.9rem;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    animation: pulse 2s infinite;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 5px;
    z-index: 10;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.loading {
    color: #666;
    font-size: 0.9rem;
    margin-top: 10px;
}

/* شريط الإعلانات */
.ad-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 90;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(15px);
    box-shadow: 0 -8px 25px rgba(0,0,0,0.2);
    border-top: 3px solid var(--primary-color);
    height: 60px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    opacity: 0;
    transform: translateY(100%);
}

.ad-banner::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(45deg, rgba(52,152,219,0.1), transparent, rgba(52,152,219,0.1));
    z-index: 1; animation: shine 5s infinite;
}

.ad-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 2;
}

.ad-content {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 0 20px;
    font-weight: 700;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    font-size: 18px;
    letter-spacing: 1px;
    color: var(--dark-color);
    white-space: nowrap;
    animation: ad-slide 20s linear infinite;
}

.ad-content i {
    color: var(--primary-color);
    font-size: 20px;
}

@keyframes ad-slide {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
}

/* النص المتحرك */
.footer-marquee {
    position: fixed; bottom: 60px; left: 0; right: 0; z-index: 90;
    background: rgba(255,255,255,0.95); backdrop-filter: blur(15px);
    box-shadow: 0 -8px 25px rgba(0,0,0,0.2); border-top: 3px solid var(--primary-color);
    height: 45px; overflow: hidden; display: flex; align-items: center;
    justify-content: center; width: 100%;
    opacity: 0;
    transform: translateY(100%);
}

.footer-marquee::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(45deg, rgba(52,152,219,0.1), transparent, rgba(52,152,219,0.1));
    z-index: 1; animation: shine 5s infinite;
}

.footer-text-container {
    width: 100%; overflow: hidden; position: relative; z-index: 2;
    height: 45px; display: flex; align-items: center; justify-content: center;
}

.footer-scrolling-text {
    display: inline-block; white-space: nowrap;
    animation: scroll-text-left-to-right 30s linear infinite;
    font-weight: 700; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    font-size: 20px; letter-spacing: 1px; color: var(--dark-color);
    padding: 0 20px; line-height: 45px;
}

/* نافذة اختيار التثبيت */
.install-choice-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); display: none; justify-content: center;
    align-items: center; z-index: 2000; backdrop-filter: blur(10px);
    animation: fadeIn 0.6s ease;
}

.install-choice-modal.show { display: flex; }

.install-choice-container {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 20px; padding: 30px;
    width: 90%; max-width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,0.4);
    position: relative;
    animation: modalSlideIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border: 2px solid var(--primary-color);
    text-align: center;
}

.install-choice-header {
    margin-bottom: 25px;
}

.install-choice-header i {
    font-size: 60px;
    color: var(--primary-color);
    margin-bottom: 15px;
}

.install-choice-title {
    font-size: 28px;
    color: var(--dark-color);
    margin-bottom: 10px;
    font-weight: bold;
}

.install-choice-subtitle {
    font-size: 18px;
    color: #666;
    margin-bottom: 25px;
}

.install-choice-buttons {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.install-choice-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 15px 20px;
    border: none;
    border-radius: 12px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    border: 2px solid var(--primary-color);
}

.install-choice-btn.download {
    background: var(--primary-color);
    color: white;
}

.install-choice-btn.install {
    background: var(--primary-color);
    color: white;
}

.install-choice-btn.share {
    background: var(--primary-color);
    color: white;
}

.install-choice-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    background: var(--secondary-color);
}

.install-choice-btn:active {
    transform: translateY(-1px);
}

.install-choice-cancel {
    background: transparent;
    color: #666;
    border: 1px solid #ddd;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.install-choice-cancel:hover {
    background: #f5f5f5;
}

/* شريط التقدم */
.progress-container {
    width: 100%;
    background-color: #f0f0f0;
    border-radius: 10px;
    margin: 15px 0;
    overflow: hidden;
    display: none;
}

.progress-bar {
    width: 0%;
    height: 20px;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    border-radius: 10px;
    transition: width 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 12px;
}

/* نافذة المشاركة المستقلة */
.share-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); display: none; justify-content: center;
    align-items: center; z-index: 2000; backdrop-filter: blur(10px);
    animation: fadeIn 0.6s ease;
}

.share-modal.show { display: flex; }

.share-container {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 20px; padding: 30px;
    width: 90%; max-width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,0.4);
    position: relative;
    animation: modalSlideIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border: 2px solid var(--primary-color);
    text-align: center;
}

.share-header {
    margin-bottom: 25px;
}

.share-header i {
    font-size: 60px;
    color: var(--primary-color);
    margin-bottom: 15px;
}

.share-title {
    font-size: 28px;
    color: var(--dark-color);
    margin-bottom: 10px;
    font-weight: bold;
}

.share-subtitle {
    font-size: 18px;
    color: #666;
    margin-bottom: 25px;
}

/* قسم مشاركة التطبيق */
.share-section {
    text-align: center;
    margin: 20px 0;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 15px;
    border: 2px solid var(--primary-color);
}

.qr-code {
    margin: 15px auto;
    padding: 15px;
    background: white;
    border-radius: 10px;
    display: inline-block;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border: 2px solid var(--primary-color);
}

.qr-code img {
    width: 180px;
    height: 180px;
    display: block;
    margin: 0 auto;
    border: 2px solid #ddd;
    border-radius: 8px;
}

.share-buttons {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-top: 20px;
}

.share-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 12px 15px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    color: white;
    font-size: 16px;
    border: 2px solid var(--primary-color);
}

.share-btn.whatsapp {
    background: var(--primary-color);
}

.share-btn.telegram {
    background: var(--primary-color);
}

.share-btn.link {
    background: var(--primary-color);
}

.share-btn.email {
    background: var(--primary-color);
}

.share-btn.sms {
    background: var(--primary-color);
}

.share-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    background: var(--secondary-color);
}

.share-btn:active {
    transform: translateY(-1px);
}

.share-note {
    margin-top: 20px;
    padding: 15px;
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    border-radius: 10px;
    border: 2px solid var(--welcome-color);
    font-size: 16px;
    color: #2e7d32;
    font-weight: bold;
}

/* الأنيميشنات المحسنة */
@keyframes spin { to { transform: rotate(360deg); } }

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
    20%, 40%, 60%, 80% { transform: translateX(10px); }
}

@keyframes headerEntrance {
    0% { opacity: 0; transform: translateY(-100px) scale(0.8); }
    50% { opacity: 0.7; transform: translateY(-20px) scale(0.95); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes boxFall {
    0% { opacity: 0; transform: translateY(100px) rotateX(45deg) scale(0.8); }
    50% { opacity: 0.7; transform: translateY(-10px) rotateX(10deg) scale(0.95); }
    100% { opacity: 1; transform: translateY(0) rotateX(0deg) scale(1); }
}

@keyframes btnEntrance {
    0% { opacity: 0; transform: scale(0) rotate(180deg); }
    50% { opacity: 0.7; transform: scale(1.1) rotate(90deg); }
    100% { opacity: 1; transform: scale(1) rotate(0deg); }
}

@keyframes footerSlideUp {
    0% { opacity: 0; transform: translateY(100%); }
    100% { opacity: 1; transform: translateY(0); }
}

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

@keyframes scroll-text-left-to-right {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

@keyframes downloadShine {
    0% { transform: translateX(-200%) translateY(-200%); }
    100% { transform: translateX(200%) translateY(200%); }
}

@keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

@keyframes modalSlideIn {
    from { opacity: 0; transform: translateY(-100px) scale(0.5) rotate(-10deg); }
    to { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
}

@keyframes ad-slide {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
}

/* تأثيرات إضافية للحاويات */
.box:nth-child(1) {
    background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,248,255,0.95) 100%);
}

/* تحسينات للشاشات المختلفة */
@media(max-width:768px){
    .container{grid-template-columns:1fr;}
    .header{flex-direction:column;gap:15px;text-align:center; padding: 0; height: 160px;}
    .buttons-grid{grid-template-columns:repeat(2,1fr); gap:10px;}
    .btn{height:50px; font-size: 14px; padding:10px 12px;}
    .box {min-height: 240px; padding: 15px;}
    .footer-marquee { height: 40px; bottom: 50px; }
    .footer-text-container { height: 40px; }
    .footer-scrolling-text { font-size: 18px; line-height: 40px; }
    .box-title { font-size: 22px; margin-bottom: 12px; }
    .btn i { font-size: 16px; }
    .btn-text { font-size: 13px; }
    .btn-image { width: 50px; height: 50px; }
    .floating-install-btn {
        top: 10px;
        left: 10px;
        padding: 10px 15px;
        font-size: 14px;
    }
    .floating-display-btn {
        top: 10px;
        right: 10px;
        padding: 10px 15px;
        font-size: 14px;
    }
    .install-choice-buttons {
        flex-direction: column;
    }
    .share-buttons {
        grid-template-columns: 1fr;
    }
    .qr-code img {
        width: 150px;
        height: 150px;
    }
    .ad-banner {
        height: 50px;
    }
    .ad-content {
        font-size: 16px;
    }
    .notification-top-container {
        top: 70px;
        padding: 0 15px;
    }
    .toast-top {
        max-width: 100%;
        padding: 12px 15px;
    }
}

@media(max-width:480px){
    .buttons-grid{grid-template-columns:1fr; gap:8px;}
    .btn{height:48px; padding:8px 12px; font-size: 13px;}
    .footer-marquee { height: 35px; bottom: 45px; }
    .footer-text-container { height: 35px; }
    .footer-scrolling-text { font-size: 16px; line-height: 35px; }
    .login-container, .blocked-container { padding: 25px; }
    .login-logo i { font-size: 40px; }
    .login-logo span { font-size: 26px; }
    .login-title { font-size: 28px; }
    .blocked-icon { font-size: 80px; }
    .blocked-title { font-size: 30px; }
    .header { height: 140px; }
    .box { min-height: 200px; padding: 12px; }
    .btn i { font-size: 16px; }
    .btn-text { font-size: 12px; }
    .btn-image { width: 45px; height: 45px; }
    .floating-install-btn {
        top: 5px;
        left: 5px;
        padding: 8px 12px;
        font-size: 12px;
    }
    .floating-display-btn {
        top: 5px;
        right: 5px;
        padding: 8px 12px;
        font-size: 12px;
    }
    .install-choice-container, .share-container {
        padding: 20px;
    }
    .install-choice-title, .share-title {
        font-size: 24px;
    }
    .share-buttons {
        grid-template-columns: 1fr;
    }
    .qr-code img {
        width: 130px;
        height: 130px;
    }
    .ad-banner {
        height: 45px;
    }
    .ad-content {
        font-size: 14px;
    }
    .notification-top-container {
        top: 60px;
        padding: 0 10px;
    }
}

@media(max-width:360px){
    .buttons-grid{grid-template-columns:1fr; gap:6px;}
    .btn{height:46px; padding:6px 10px; font-size: 12px;}
    .btn i { font-size: 14px; }
    .btn-text { font-size: 11px; }
    .btn-image { width: 40px; height: 40px; }
    .box-title { font-size: 20px; margin-bottom: 10px; }
    .header { height: 120px; }
    .floating-install-btn {
        top: 5px;
        left: 5px;
        padding: 6px 10px;
        font-size: 11px;
    }
    .floating-display-btn {
        top: 5px;
        right: 5px;
        padding: 6px 10px;
        font-size: 11px;
    }
    .ad-banner {
        height: 40px;
    }
    .ad-content {
        font-size: 13px;
    }
    .notification-top-container {
        top: 55px;
    }
}
</style>
</head>
<body>

<!-- إعلانات AMP -->
<amp-auto-ads type="adsense" data-ad-client="ca-pub-1154460052219362"></amp-auto-ads>

<!-- زر تثبيت التطبيق العائم -->
<button class="floating-install-btn" id="floatingInstallBtn">
    <i class="fas fa-download"></i> تثبيت التطبيق
</button>

<!-- زر العرض العائم - تم تعديل موقعه -->
<button class="floating-display-btn" id="floatingDisplayBtn" onclick="openPage('mr.html')">
    <i class="fas fa-info-circle"></i> العرض
</button>

<!-- حاوية الإشعارات العلوية -->
<div class="notification-top-container" id="notificationTopContainer"></div>

<!-- نافذة اختيار التثبيت -->
<div class="install-choice-modal" id="installChoiceModal">
    <div class="install-choice-container">
        <button class="close-btn" id="closeInstallChoice">
            <i class="fas fa-times"></i>
        </button>
        <div class="install-choice-header">
            <i class="fas fa-mobile-alt"></i>
            <h2 class="install-choice-title">تثبيت تطبيق AZ</h2>
            <p class="install-choice-subtitle">اختر الطريقة التي تفضلها لتثبيت التطبيق</p>
        </div>
        
        <div class="install-choice-buttons">
            <button class="install-choice-btn download" id="downloadAppBtn">
                <i class="fas fa-download"></i>
                <span>تحميل التطبيق (APK)</span>
            </button>
            <button class="install-choice-btn install" id="installAppBtn">
                <i class="fas fa-mobile-alt"></i>
                <span>تثبيت كتطبيق ويب (PWA)</span>
            </button>
            <button class="install-choice-btn share" id="shareAppBtn">
                <i class="fas fa-share-alt"></i>
                <span>مشاركة التطبيق</span>
            </button>
        </div>
        
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>
        
        <button class="install-choice-cancel" id="cancelInstallBtn">إلغاء</button>
    </div>
</div>

<!-- نافذة المشاركة المستقلة -->
<div class="share-modal" id="shareModal">
    <div class="share-container">
        <button class="close-btn" id="closeShareModal">
            <i class="fas fa-times"></i>
        </button>
        <div class="share-header">
            <i class="fas fa-share-alt"></i>
            <h2 class="share-title">مشاركة تطبيق AZ</h2>
            <p class="share-subtitle">شارك التطبيق مع أصدقائك وعائلتك</p>
        </div>
        
        <div class="share-section">
            <div class="qr-code">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=https://e772299420-hue.github.io/Call/" 
                     alt="QR Code للتطبيق">
                <p>📱 مسح الكود لفتح التطبيق</p>
            </div>
            
            <div class="share-buttons">
                <button class="share-btn whatsapp" onclick="shareOnWhatsApp()">
                    <i class="fab fa-whatsapp"></i>
                    واتساب
                </button>
                <button class="share-btn telegram" onclick="shareOnTelegram()">
                    <i class="fab fa-telegram"></i>
                    تليجرام
                </button>
                <button class="share-btn link" onclick="copyAppLink()">
                    <i class="fas fa-link"></i>
                    نسخ الرابط
                </button>
                <button class="share-btn email" onclick="shareViaEmail()">
                    <i class="fas fa-envelope"></i>
                    إرسال بريد
                </button>
                <button class="share-btn sms" onclick="shareViaSMS()">
                    <i class="fas fa-sms"></i>
                    رسالة نصية
                </button>
                <button class="share-btn link" onclick="shareViaMessenger()">
                    <i class="fab fa-facebook-messenger"></i>
                    ماسنجر
                </button>
            </div>
            
            <div class="share-note">
                <i class="fas fa-info-circle"></i>
                رابط التطبيق: https://e772299420-hue.github.io/Call/
            </div>
        </div>
        
        <button class="install-choice-cancel" onclick="closeShareModal()">إغلاق</button>
    </div>
</div>

<!-- شاشة تسجيل الدخول للإدارة -->
<div class="login-modal" id="adminLoginModal">
    <div class="login-container">
        <button class="close-btn" id="closeAdminLogin">
            <i class="fas fa-times"></i>
        </button>
        <div class="login-header">
            <div class="login-logo">
                <i class="fas fa-user-cog"></i>
                <span>AZ</span>
            </div>
            <h2 class="login-title">تسجيل الدخول للإدارة</h2>
            <p class="login-subtitle">أدخل بيانات الدخول للوصول إلى لوحة الإدارة</p>
        </div>
        
        <form id="adminLoginForm">
            <div class="form-group">
                <label for="adminUsername">اسم المستخدم</label>
                <input type="text" id="adminUsername" name="username" required>
            </div>
            
            <div class="form-group">
                <label for="adminPassword">كلمة المرور</label>
                <input type="password" id="adminPassword" name="password" required>
                <i class="fas fa-eye password-toggle" id="toggleAdminPassword"></i>
            </div>
            
            <button type="submit" class="login-btn" id="adminLoginBtn">
                تسجيل الدخول
                <span class="loading-spinner" id="adminLoadingSpinner" style="display: none;"></span>
            </button>
        </form>
        
        <div id="adminLoginMessage" class="login-message"></div>
    </div>
</div>

<!-- مؤشرات الحالة (مخفية) -->
<div class="status-bar" style="display: none;">
    <div class="status-indicator" id="connectionStatus">
        <i class="fas fa-wifi"></i>
        <span>جاري التحقق...</span>
    </div>
    <div class="status-indicator tracking" id="trackingStatus">
        <i class="fas fa-chart-line"></i>
        <span>تتبع نشط</span>
    </div>
</div>

<!-- شريط الهيدر الموسع والمحسن -->
<div class="header" id="mainHeader">
    <img src="https://github.com/e772299420-hue/Call/blob/main/qn5Z9EfLxfnVNzSVoq5UrqZiCdHTjG6LsHbBKskX.png?raw=true" alt="AZ السوق الشامل" class="header-image">
</div>

<div class="container">
    <div class="box" id="box1">
        <h2 class="box-title" onclick="refreshPage()">
            <i class="fas fa-shopping-cart" style="color: #e74c3c;"></i> خدمات التسوق الإلكتروني
        </h2>
        <div class="buttons-grid">
            <button class="btn" onclick="openPage('1_1.html')">
                <div class="btn-image-container">
                    <img src="https://github.com/e772299420-hue/Call/blob/main/d7a7c4a0554870bafe1c5147ef23a7e3.jpg?raw=true" class="btn-image" alt="منتجات تجارية">
                </div>
                <div class="btn-text-container">
                    <span class="btn-text">قسم المنتجات التجارية الجديدة</span>
                    <span class="btn-description">منتجات جديدة بجودة عالية وأسعار منافسة</span>
                </div>
            </button>
            <button class="btn" onclick="openPage('1_2.html')">
                <div class="btn-image-container">
                    <img src="https://github.com/e772299420-hue/Call/blob/main/cd97c05facff694b6b52a172515e9d3c.jpg?raw=true" class="btn-image" alt="منتجات مستعملة">
                </div>
                <div class="btn-text-container">
                    <span class="btn-text">قسم المنتجات المستعملة - الحراج</span>
                    <span class="btn-description">منتجات مستعملة بحالة جيدة وبأسعار مناسبة</span>
                </div>
            </button>
            <button class="btn" onclick="openPage('1_5.html')">
                <div class="btn-image-container">
                    <img src="https://github.com/e772299420-hue/Call/blob/main/a5a20fa9a3807a95931b6f72c27ee7b8.jpg?raw=true" class="btn-image" alt="عقارات">
                </div>
                <div class="btn-text-container">
                    <span class="btn-text">قسم المباني والعقارات</span>
                    <span class="btn-description">عروض عقارية متنوعة للبيع والإيجار</span>
                </div>
            </button>
            <button class="btn" onclick="openPage('1_6.html')">
                <div class="btn-image-container">
                    <img src="https://github.com/e772299420-hue/Call/blob/main/d482cf356de039d8948fa6aa5d03d714.jpg?raw=true" class="btn-image" alt="وظائف">
                </div>
                <div class="btn-text-container">
                    <span class="btn-text">قسم الوظائف الشاغرة</span>
                    <span class="btn-description">فرص عمل متنوعة في مختلف المجالات</span>
                </div>
            </button>
            <button class="btn" onclick="openPage('index_mt.html')">
                <div class="btn-image-container">
                    <img src="https://github.com/e772299420-hue/Call/blob/main/Mtam.jpg?raw=true" class="btn-image" alt="توصيل">
                </div>
                <div class="btn-text-container">
                    <span class="btn-text">قسم الطلب والتوصيل السريع</span>
                    <span class="btn-description">اطلب وجبتك . . . تصلك لباب البيت</span>
                </div>
            </button>
            <button class="btn" onclick="openPage('txtx.html')">
                <div class="btn-image-container">
                    <img src="https://github.com/e772299420-hue/Call/blob/main/8c07f7dd19725e5bba114aa40a1db919.jpg?raw=true" class="btn-image" alt="أرقام">
                </div>
                <div class="btn-text-container">
                    <span class="btn-text">أرقام ومواقع أشخاص تهمك</span>
                    <span class="btn-description">ابحث عن باص او دراجة نارية او فني علا خريطة AZ</span>
                </div>
            </button>
            
            <!-- زر القائمة المنسدلة - تم تعديل الأيقونة -->
            <button class="menu-btn" id="menuToggleBtn">
                <i class="fas fa-bars"></i>
                <span class="btn-text">القائمة الرئيسية</span>
                <div class="merchant-counter-badge" id="merchantCounter"></div>
            </button>
            
            <!-- القائمة المنسدلة -->
            <div class="menu-dropdown" id="settingsMenu">
                <div class="menu-item" onclick="openPage('as.html')">
                    <i class="fas fa-user-plus"></i>
                    <span>طلب الانضمام</span>
                </div>
                <div class="menu-item" onclick="openPage('help.html')">
                    <i class="fas fa-question-circle"></i>
                    <span>الشرح والتعليم</span>
                </div>
                <div class="menu-item" onclick="installAppDirect()">
                    <i class="fas fa-download"></i>
                    <span>تثبيت التطبيق</span>
                </div>
                <div class="menu-item" onclick="openShareModal()">
                    <i class="fas fa-share-alt"></i>
                    <span>مشاركة التطبيق</span>
                </div>
                <div class="menu-item" onclick="openAdminLogin()">
                    <i class="fas fa-user-cog"></i>
                    <span>لوحة الإدارة</span>
                </div>
                <div class="menu-item" onclick="openPage('seasa.html')">
                    <i class="fas fa-shield-alt"></i>
                    <span>سياسة الخصوصية</span>
                </div>
                <div class="menu-item" onclick="openPage('mr.html')">
                    <i class="fas fa-info-circle"></i>
                    <span>من نحن</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- شريط الإعلانات -->
<div class="ad-banner" id="adBanner">
    <div class="ad-container">
        <div class="ad-content">
            <i class="fas fa-ad"></i>
            <span>تطبيق AZ السوق الشامل - أفضل منصة للتسوق الإلكتروني في اليمن</span>
            <i class="fas fa-star"></i>
            <span>للإعلان على الموقع: 772299420</span>
        </div>
    </div>
</div>

<!-- النص المتحرك في التذييل -->
<div class="footer-marquee" id="footerMarquee">
    <div class="footer-text-container">
        <div class="footer-scrolling-text" id="footerScrollingText">
            الراعي الرسمي لهذا المتجر المميز سوفت للأنظمة المحاسبية المتكاملة أول نظام محاسبي يصنع حسب الطلب للطلب والاستفسار اتصل على 772299420
        </div>
    </div>
</div>

<script>
// تهيئة Firebase
const firebaseConfig = {
    databaseURL: "https://chat-fat-free-default-rtdb.firebaseio.com/"
};

const app = firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// ===== نظام إدارة المستخدم العام المحسن والمصحح =====
const globalUser = {
    data: null,
    
    setUserData: function(userData) {
        try {
            if (userData && typeof userData === 'object') {
                this.data = userData;
                sessionStorage.setItem('globalUserData', JSON.stringify(userData));
                console.log('✅ تم تخزين بيانات المستخدم في الجلسة:', userData);
            } else {
                console.error('❌ بيانات المستخدم غير صالحة');
            }
        } catch (error) {
            console.error('❌ خطأ في حفظ بيانات المستخدم:', error);
        }
    },
    
    getUserData: function() {
        if (this.data) return this.data;
        
        try {
            const storedData = sessionStorage.getItem('globalUserData');
            if (storedData) {
                this.data = JSON.parse(storedData);
                return this.data;
            }
        } catch (error) {
            console.error('❌ خطأ في تحميل بيانات المستخدم:', error);
        }
        return null;
    },
    
    getUsername: function() {
        try {
            const userData = this.getUserData();
            return userData ? userData.username : 'زائر';
        } catch (error) {
            return 'زائر';
        }
    },
    
    getUserId: function() {
        try {
            const userData = this.getUserData();
            return userData ? userData.id : null;
        } catch (error) {
            return null;
        }
    },
    
    isLoggedIn: function() {
        return this.getUserData() !== null;
    },
    
    logout: function() {
        try {
            this.data = null;
            sessionStorage.removeItem('globalUserData');
            console.log('🚪 تم تسجيل الخروج');
        } catch (error) {
            console.error('❌ خطأ في تسجيل الخروج:', error);
        }
    }
};

// ===== نظام تخزين بيانات التاجر في الجلوبال =====
const merchantGlobal = {
    setMerchantName: function(name) {
        sessionStorage.setItem('merchantName', name);
        console.log('✅ تم حفظ اسم التاجر في الجلوبال:', name);
    },
    
    getMerchantName: function() {
        return sessionStorage.getItem('merchantName') || '';
    },
    
    setMerchantPhone: function(phone) {
        sessionStorage.setItem('merchantPhone', phone);
        console.log('✅ تم حفظ رقم التاجر في الجلوبال:', phone);
    },
    
    getMerchantPhone: function() {
        return sessionStorage.getItem('merchantPhone') || '';
    },
    
    setMerchantId: function(merchantId) {
        sessionStorage.setItem('merchantId', merchantId);
        console.log('✅ تم حفظ معرف التاجر في الجلوبال:', merchantId);
    },
    
    getMerchantId: function() {
        return sessionStorage.getItem('merchantId') || '';
    },
    
    clearAll: function() {
        sessionStorage.removeItem('merchantName');
        sessionStorage.removeItem('merchantPhone');
        sessionStorage.removeItem('merchantId');
        console.log('🧹 تم إفراغ جميع بيانات التاجر من الجلوبال');
    }
};

// ===== نظام تتبع الزوار المحسن والمصحح =====
class AdvancedVisitorTracker {
    constructor() {
        this.visitorId = this.getOrCreateVisitorId();
        this.sessionId = this.generateSessionId();
        this.currentPage = this.getCurrentPage();
        this.startTime = Date.now();
        this.isOnline = navigator.onLine;
        this.heartbeatInterval = null;
        
        this.visitorsRef = database.ref('visitors');
        this.datVisitorsRef = database.ref('dat_visitors');
        this.bagVisitorsRef = database.ref('bag_visitors');
        
        console.log('🚀 تم تهيئة نظام تتبع الزوار المتقدم');
    }
    
    getOrCreateVisitorId() {
        let visitorId = localStorage.getItem("visitorId");
        if (!visitorId) {
            visitorId = 'visitor_' + Date.now() + '_' + Math.floor(Math.random() * 100000);
            localStorage.setItem("visitorId", visitorId);
            localStorage.setItem("firstVisit", new Date().toISOString());
        }
        return visitorId;
    }
    
    generateSessionId() {
        return 'session_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
    }
    
    getCurrentPage() {
        return window.location.pathname.split("/").pop() || "index.html";
    }
    
    async getIPAddress() {
        const services = [
            "https://api.ipify.org?format=json",
            "https://api64.ipify.org?format=json"
        ];
        
        for (let service of services) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(service, { 
                    signal: controller.signal 
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    const data = await response.json();
                    return data.ip || 'unknown';
                }
            } catch (error) {
                console.warn(`⚠️ فشل جلب IP من ${service}:`, error);
                continue;
            }
        }
        return "unknown";
    }
    
    async startTracking() {
        console.log('📊 بدء تتبع الزائر...');
        
        try {
            const ipAddress = await this.getIPAddress();
            await this.registerVisitor(ipAddress);
            this.startHeartbeat();
            this.setupEventListeners();
            console.log('✅ تم بدء تتبع الزائر بنجاح');
        } catch (error) {
            console.error('❌ فشل في بدء التتبع:', error);
        }
    }
    
    async registerVisitor(ipAddress) {
        try {
            const visitorSnapshot = await this.visitorsRef.orderByChild('ip').equalTo(ipAddress).once('value');
            let visitorNumber = null;
            
            if (visitorSnapshot.exists()) {
                const data = visitorSnapshot.val();
                for (const key of Object.keys(data)) {
                    visitorNumber = key;
                    await this.visitorsRef.child(visitorNumber).update({
                        lastVisit: new Date().toISOString(),
                        status: 'نشط',
                        visitorId: this.visitorId,
                        ip: ipAddress
                    });
                    break;
                }
            } else {
                const counterSnapshot = await this.visitorsRef.orderByKey().limitToLast(1).once('value');
                let newNumber = 1;
                
                if (counterSnapshot.exists()) {
                    const data = counterSnapshot.val();
                    for (const key of Object.keys(data)) {
                        const currentNumber = parseInt(key) || 0;
                        newNumber = currentNumber > 0 ? currentNumber + 1 : 1;
                        break;
                    }
                }
                
                visitorNumber = newNumber.toString();
                
                await this.visitorsRef.child(visitorNumber).set({
                    visitorId: this.visitorId,
                    ip: ipAddress,
                    status: 'نشط',
                    firstVisit: new Date().toISOString(),
                    lastVisit: new Date().toISOString(),
                    totalVisits: 1,
                    userAgent: navigator.userAgent,
                    platform: navigator.platform
                });
            }
            
            await this.registerDailyVisit(visitorNumber);
            await this.registerPageVisit(visitorNumber);
            this.saveLocalData(visitorNumber, ipAddress);
            
        } catch (error) {
            console.error('❌ خطأ في تسجيل الزائر:', error);
        }
    }
    
    async registerDailyVisit(visitorNumber) {
        try {
            const today = new Date().toISOString().split('T')[0];
            const compositeKey = visitorNumber + '_' + today;
            
            const dateVisitSnapshot = await this.datVisitorsRef
                .orderByChild('visitorNumber_date')
                .equalTo(compositeKey)
                .once('value');
            
            if (!dateVisitSnapshot.exists()) {
                await this.datVisitorsRef.push({
                    visitorNumber: visitorNumber,
                    date: today,
                    visitorNumber_date: compositeKey,
                    visitCount: 1,
                    firstVisitTime: new Date().toISOString(),
                    lastVisitTime: new Date().toISOString()
                });
            } else {
                const updates = {};
                for (const key of Object.keys(dateVisitSnapshot.val())) {
                    updates[`${key}/lastVisitTime`] = new Date().toISOString();
                    updates[`${key}/visitCount`] = (dateVisitSnapshot.val()[key].visitCount || 0) + 1;
                }
                await this.datVisitorsRef.update(updates);
            }
        } catch (error) {
            console.error('❌ خطأ في تسجيل زيارة اليوم:', error);
        }
    }
    
    async registerPageVisit(visitorNumber) {
        try {
            const today = new Date().toISOString().split('T')[0];
            const pageName = this.getCurrentPage();
            const enterTime = new Date().toISOString();
            
            const lastSerialSnapshot = await this.bagVisitorsRef
                .orderByChild('visitorNumber_date')
                .equalTo(visitorNumber + '_' + today)
                .once('value');
            
            let serialNumber = 1;
            if (lastSerialSnapshot.exists()) {
                const data = lastSerialSnapshot.val();
                for (const key of Object.keys(data)) {
                    const currentSerial = data[key].serialNumber || 0;
                    if (currentSerial >= serialNumber) {
                        serialNumber = currentSerial + 1;
                    }
                }
            }
            
            const pageVisitRef = await this.bagVisitorsRef.push({
                visitorNumber: visitorNumber,
                date: today,
                visitorNumber_date: visitorNumber + '_' + today,
                serialNumber: serialNumber,
                pageName: pageName,
                enterTime: enterTime,
                exitTime: null,
                exitDate: null,
                sessionId: this.sessionId,
                pageTitle: document.title
            });
            
            localStorage.setItem('currentPageVisitId', pageVisitRef.key);
            localStorage.setItem('currentPageEnterTime', enterTime);
            
        } catch (error) {
            console.error('❌ خطأ في تسجيل دخول الصفحة:', error);
        }
    }
    
    async updatePageExit() {
        try {
            const pageVisitId = localStorage.getItem('currentPageVisitId');
            if (!pageVisitId) return;
            
            const exitTime = new Date().toISOString();
            const exitDate = new Date().toISOString().split('T')[0];
            
            await this.bagVisitorsRef.child(pageVisitId).update({
                exitTime: exitTime,
                exitDate: exitDate,
                sessionDuration: Date.now() - this.startTime
            });
            
            localStorage.removeItem('currentPageVisitId');
            localStorage.removeItem('currentPageEnterTime');
            
        } catch (error) {
            console.error('❌ خطأ في تحديث خروج الصفحة:', error);
        }
    }
    
    saveLocalData(visitorNumber, ipAddress) {
        const visitorData = {
            visitorNumber: visitorNumber,
            visitorId: this.visitorId,
            sessionId: this.sessionId,
            ip: ipAddress,
            currentPage: this.currentPage,
            enterTime: new Date().toISOString(),
            startTime: this.startTime
        };
        
        localStorage.setItem('visitorData', JSON.stringify(visitorData));
        localStorage.setItem('visitorData_timestamp', Date.now().toString());
    }
    
    startHeartbeat() {
        this.heartbeatInterval = setInterval(async () => {
            try {
                const visitorData = JSON.parse(localStorage.getItem('visitorData') || '{}');
                if (visitorData.visitorNumber) {
                    await this.visitorsRef.child(visitorData.visitorNumber).update({
                        lastActivity: new Date().toISOString()
                    });
                }
            } catch (error) {
                console.error('❌ خطأ في تحديث النشاط:', error);
            }
        }, 30000);
    }
    
    setupEventListeners() {
        window.addEventListener('online', () => {
            this.isOnline = true;
        });
        
        window.addEventListener('offline', () => {
            this.isOnline = false;
        });
        
        const events = ['click', 'scroll', 'keypress', 'mousemove', 'touchstart'];
        for (const event of events) {
            document.addEventListener(event, () => {
                this.recordActivity();
            }, { passive: true });
        }
        
        window.addEventListener('beforeunload', () => {
            this.handlePageExit();
        });
        
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                this.handlePageHidden();
            } else {
                this.handlePageVisible();
            }
        });
    }
    
    recordActivity() {
        // يمكن إضافة تسجيل النشاط إذا لزم الأمر
    }
    
    handlePageHidden() {
        // تحديث حالة الصفحة عندما تكون مخفية
    }
    
    handlePageVisible() {
        // تحديث حالة الصفحة عندما تكون مرئية
    }
    
    async handlePageExit() {
        try {
            await this.updatePageExit();
            
            const visitorData = JSON.parse(localStorage.getItem('visitorData') || '{}');
            if (visitorData.visitorNumber) {
                await this.visitorsRef.child(visitorData.visitorNumber).update({
                    lastExit: new Date().toISOString()
                });
            }
        } catch (error) {
            console.error('❌ خطأ في معالجة خروج الصفحة:', error);
        }
    }
    
    stopTracking() {
        if (this.heartbeatInterval) {
            clearInterval(this.heartbeatInterval);
            this.heartbeatInterval = null;
        }
        console.log('🛑 تم إيقاف مراقبة الزائر');
    }
}

// إنشاء مثيل من نظام المراقبة المتقدم
const visitorTracker = new AdvancedVisitorTracker();

// ===== نظام مراقبة التجار غير النشطين - مصحح =====
class MerchantMonitor {
    constructor() {
        this.merchantsRef = database.ref('merchants');
        this.joinRequestsRef = database.ref('join_requests');
        this.merchantCounter = document.getElementById('merchantCounter');
        this.init();
    }
    
    async init() {
        console.log('🚀 بدء نظام مراقبة التجار');
        this.startMerchantsMonitoring();
        this.startJoinRequestsMonitoring();
    }
    
    startMerchantsMonitoring() {
        this.merchantsRef.on('value', (snapshot) => {
            try {
                const merchantsData = snapshot.val();
                this.checkMerchantsStatus(merchantsData);
            } catch (error) {
                console.error('❌ خطأ في مراقبة التجار:', error);
            }
        });
    }
    
    async checkMerchantsStatus(merchantsData) {
        if (!merchantsData) {
            this.updateMerchantCounter(0);
            return;
        }
        
        let inactiveWithDefaultPasswordCount = 0;
        
        for (const merchantId of Object.keys(merchantsData)) {
            const merchant = merchantsData[merchantId];
            
            const isInactive = merchant && merchant.status && 
                             merchant.status.toLowerCase() === 'inactive';
            const hasDefaultPassword = merchant && merchant.password && 
                                     merchant.password === 'default_password';
            
            if (isInactive && hasDefaultPassword) {
                inactiveWithDefaultPasswordCount++;
            }
        }
        
        this.updateMerchantCounter(inactiveWithDefaultPasswordCount);
    }
    
    startJoinRequestsMonitoring() {
        this.joinRequestsRef.on('value', (snapshot) => {
            try {
                const requestsData = snapshot.val();
                this.checkJoinRequests(requestsData);
            } catch (error) {
                console.error('❌ خطأ في مراقبة طلبات الانضمام:', error);
            }
        });
    }
    
    async checkJoinRequests(requestsData) {
        if (!requestsData) {
            return;
        }
        
        let pendingRequestsCount = 0;
        
        for (const requestId of Object.keys(requestsData)) {
            const request = requestsData[requestId];
            const isPending = request && request.status && 
                            request.status.toLowerCase() === 'pending';
            
            if (isPending) {
                pendingRequestsCount++;
            }
        }
        
        console.log(`📋 طلبات الانضمام المعلقة: ${pendingRequestsCount}`);
    }
    
    updateMerchantCounter(count) {
        if (this.merchantCounter) {
            if (count > 0) {
                this.merchantCounter.textContent = count;
                this.merchantCounter.style.display = 'block';
            } else {
                this.merchantCounter.style.display = 'none';
            }
        }
    }
}

// ===== نظام إشعار طلب الانضمام =====
class JoinRequestNotification {
    constructor() {
        this.joinRequestsRef = database.ref('join_requests');
        this.init();
    }
    
    async init() {
        this.startRealTimeMonitoring();
    }
    
    startRealTimeMonitoring() {
        this.joinRequestsRef.on('value', (snapshot) => {
            try {
                const requestsData = snapshot.val();
                let pendingCount = 0;

                if (requestsData) {
                    for (const requestId of Object.keys(requestsData)) {
                        const request = requestsData[requestId];
                        const isPending = request && request.status && 
                                        request.status.toLowerCase() === 'pending';
                        
                        if (isPending) {
                            pendingCount++;
                        }
                    }
                }
            } catch (error) {
                console.error('❌ خطأ في مراقبة طلبات الانضمام:', error);
            }
        });
    }
}

// ===== نظام تثبيت التطبيق المحسن والمحسّن =====
let deferredPrompt;
let isAppInstalled = false;
let installCheckInterval = null;

// نظام اكتشاف PWA المتقدم والمصحح
class PWAInstallationDetector {
    constructor() {
        this.installButton = document.getElementById('floatingInstallBtn');
        this.checkInterval = null;
        this.init();
    }
    
    init() {
        console.log('🔍 بدء نظام اكتشاف تثبيت PWA المتقدم');
        this.setupEventListeners();
        this.startPeriodicChecking();
    }
    
    setupEventListeners() {
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('📱 PWA جاهز للتثبيت');
            this.updateInstallButtonState();
        });
        
        window.addEventListener('appinstalled', (evt) => {
            console.log('🎉 تم تثبيت تطبيق AZ بنجاح!');
            localStorage.setItem('appInstalled', 'true');
            localStorage.setItem('appInstallationTime', new Date().toISOString());
            this.updateInstallButtonState();
            showNotification('✅ تم تثبيت التطبيق بنجاح!', 'success');
        });
        
        window.addEventListener('load', () => {
            this.updateInstallButtonState();
        });
        
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                this.updateInstallButtonState();
            }
        });
    }
    
    checkIfAppInstalled() {
        try {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            const isInWebApp = window.navigator.standalone === true;
            const isInstalledInStorage = localStorage.getItem('appInstalled') === 'true';
            const hasDeferredPrompt = !!deferredPrompt;

            const isInstalled = isStandalone || isInWebApp || 
                               (isInstalledInStorage && !hasDeferredPrompt);
            
            console.log('🔍 فحص حالة التثبيت:', {
                isStandalone,
                isInWebApp,
                isInstalledInStorage,
                hasDeferredPrompt,
                isInstalled
            });
            
            return isInstalled;
            
        } catch (error) {
            console.error('❌ خطأ في فحص حالة التثبيت:', error);
            return false;
        }
    }
    
    updateInstallButtonState() {
        try {
            const isInstalled = this.checkIfAppInstalled();
            
            if (isInstalled && this.installButton) {
                this.installButton.classList.add('hidden');
                console.log('🎯 إخفاء زر التثبيت - التطبيق مثبت');
            } else if (this.installButton) {
                this.installButton.classList.remove('hidden');
                console.log('🎯 إظهار زر التثبيت - التطبيق غير مثبت');
            }
        } catch (error) {
            console.error('❌ خطأ في تحديث حالة زر التثبيت:', error);
        }
    }
    
    startPeriodicChecking() {
        this.checkInterval = setInterval(() => {
            this.updateInstallButtonState();
        }, 5000);
    }
    
    stopPeriodicChecking() {
        if (this.checkInterval) {
            clearInterval(this.checkInterval);
            this.checkInterval = null;
        }
    }
}

// إنشاء مثيل من نظام الاكتشاف المتقدم
let pwaDetector = null;

async function installPWA() {
    if (!deferredPrompt) {
        console.log('❌ PWA غير متاح للتثبيت');
        showNotification('❌ التثبيت التلقائي غير متاح. يرجى استخدام خيار التحميل.', 'error');
        return false;
    }
    
    try {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        
        if (outcome === 'accepted') {
            console.log('✅ تم قبول تثبيت التطبيق');
            localStorage.setItem('appInstalled', 'true');
            localStorage.setItem('appInstallationTime', new Date().toISOString());
            if (pwaDetector) pwaDetector.updateInstallButtonState();
            return true;
        } else {
            console.log('❌ تم رفض تثبيت التطبيق');
            return false;
        }
    } catch (error) {
        console.error('❌ خطأ في تثبيت PWA:', error);
        showNotification('❌ فشل في التثبيت التلقائي. جاري فتح خيار التحميل...', 'error');
        return false;
    }
}

function downloadAppDirect() {
    const downloadUrl = 'https://drive.google.com/uc?export=download&id=1iPwYBIEvs-RvXryeDNOHZVpbZrcm6q-9';
    
    showNotification('📱 جاري تحميل التطبيق...', 'info');
    
    const link = document.createElement('a');
    link.href = downloadUrl;
    link.download = 'AZالسوق الشامل.apk';
    link.target = '_blank';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    setTimeout(() => {
        window.open(downloadUrl, '_blank');
    }, 1000);
    
    const visitorData = JSON.parse(localStorage.getItem('visitorData') || '{}');
    if (visitorData.visitorNumber) {
        database.ref('visitors').child(visitorData.visitorNumber).update({
            lastAppDownload: new Date().toISOString(),
            downloadCount: (visitorData.downloadCount || 0) + 1
        });
    }
}

// ===== نظام تثبيت التطبيق الجديد =====
function showInstallChoice() {
    const modal = document.getElementById('installChoiceModal');
    modal.classList.add('show');
}

function setupInstallChoice() {
    const modal = document.getElementById('installChoiceModal');
    const closeBtn = document.getElementById('closeInstallChoice');
    const downloadBtn = document.getElementById('downloadAppBtn');
    const installBtn = document.getElementById('installAppBtn');
    const shareBtn = document.getElementById('shareAppBtn');
    const cancelBtn = document.getElementById('cancelInstallBtn');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    
    closeBtn.addEventListener('click', () => {
        modal.classList.remove('show');
        progressContainer.style.display = 'none';
        progressBar.style.width = '0%';
        progressBar.textContent = '0%';
    });
    
    cancelBtn.addEventListener('click', () => {
        modal.classList.remove('show');
        progressContainer.style.display = 'none';
        progressBar.style.width = '0%';
        progressBar.textContent = '0%';
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('show');
            progressContainer.style.display = 'none';
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
        }
    });
    
    downloadBtn.addEventListener('click', () => {
        progressContainer.style.display = 'block';
        
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress >= 100) {
                progress = 100;
                clearInterval(interval);
                
                setTimeout(() => {
                    downloadAppDirect();
                    setTimeout(() => {
                        modal.classList.remove('show');
                        progressContainer.style.display = 'none';
                        progressBar.style.width = '0%';
                        progressBar.textContent = '0%';
                    }, 1000);
                }, 500);
            }
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }, 200);
    });
    
    installBtn.addEventListener('click', async () => {
        const success = await installPWA();
        if (success) {
            modal.classList.remove('show');
            showNotification('✅ تم بدء تثبيت التطبيق بنجاح!', 'success');
        } else {
            showNotification('⚠️ يمكنك استخدام خيار التحميل بدلاً من ذلك.', 'info');
            setTimeout(() => {
                downloadAppDirect();
            }, 2000);
        }
    });
    
    shareBtn.addEventListener('click', () => {
        modal.classList.remove('show');
        openShareModal();
    });
}

// ===== نظام الإشعارات العلوية المحسّن =====
function showNotification(message, type = 'info') {
    const notificationContainer = document.getElementById('notificationTopContainer');
    if (!notificationContainer) return;
    
    const toast = document.createElement('div');
    toast.className = `toast-top ${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    notificationContainer.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 5000);
}

// ===== نظام مشاركة التطبيق المحسن =====
function openShareModal() {
    const modal = document.getElementById('shareModal');
    modal.classList.add('show');
    console.log('✅ تم فتح نافذة المشاركة');
}

function closeShareModal() {
    const modal = document.getElementById('shareModal');
    modal.classList.remove('show');
}

function setupShareModal() {
    const modal = document.getElementById('shareModal');
    const closeBtn = document.getElementById('closeShareModal');
    
    closeBtn.addEventListener('click', closeShareModal);
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeShareModal();
        }
    });
}

function shareOnWhatsApp() {
    const url = `https://wa.me/?text=${encodeURIComponent('تطبيق AZ السوق الشامل - لتلبية احتياجك بالكامل\n\nقم بتحميل التطبيق الآن:\nhttps://e772299420-hue.github.io/Call/')}`;
    window.open(url, '_blank');
    console.log('📱 مشاركة عبر واتساب');
    showNotification('📱 جاري فتح واتساب للمشاركة...', 'info');
}

function shareOnTelegram() {
    const url = `https://t.me/share/url?url=${encodeURIComponent('https://e772299420-hue.github.io/Call/')}&text=${encodeURIComponent('تطبيق AZ السوق الشامل - لتلبية احتياجك بالكامل')}`;
    window.open(url, '_blank');
    console.log('📢 مشاركة عبر تليجرام');
    showNotification('📢 جاري فتح تليجرام للمشاركة...', 'info');
}

function copyAppLink() {
    const appLink = 'https://e772299420-hue.github.io/Call/';
    navigator.clipboard.writeText(appLink).then(() => {
        showNotification('✅ تم نسخ رابط التطبيق! يمكنك مشاركته الآن.', 'success');
        console.log('📋 نسخ الرابط');
    }).catch(() => {
        const tempInput = document.createElement('input');
        tempInput.value = appLink;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        showNotification('✅ تم نسخ رابط التطبيق! يمكنك مشاركته الآن.', 'success');
    });
}

function shareViaEmail() {
    const subject = 'تطبيق AZ السوق الشامل';
    const body = 'مرحباً،\n\nأود مشاركة تطبيق AZ السوق الشامل معك. التطبيق يوفر خدمات متكاملة للتسوق الإلكتروني والخدمات التجارية.\n\nرابط التطبيق: https://e772299420-hue.github.io/Call/\n\nمع تحياتي';
    const url = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = url;
    console.log('📧 مشاركة عبر البريد الإلكتروني');
    showNotification('📧 جاري فتح البريد الإلكتروني للمشاركة...', 'info');
}

function shareViaSMS() {
    const body = 'تطبيق AZ السوق الشامل - لتلبية احتياجك بالكامل\nرابط التطبيق: https://e772299420-hue.github.io/Call/';
    const url = `sms:?body=${encodeURIComponent(body)}`;
    window.location.href = url;
    console.log('💬 مشاركة عبر الرسائل النصية');
    showNotification('💬 جاري فتح الرسائل النصية للمشاركة...', 'info');
}

function shareViaMessenger() {
    const url = `fb-messenger://share?link=${encodeURIComponent('https://e772299420-hue.github.io/Call/')}`;
    window.open(url, '_blank');
    console.log('💙 مشاركة عبر ماسنجر');
    showNotification('💙 جاري فتح ماسنجر للمشاركة...', 'info');
}

// ===== وظائف التطبيق الأساسية =====
function refreshPage() {
    window.location.reload();
}

function openPage(pageUrl) {
    const timestamp = new Date().getTime();
    const fullUrl = '/Call/' + pageUrl + '?v=' + timestamp;
    
    if (typeof visitorTracker !== 'undefined') {
        visitorTracker.updatePageExit().then(() => {
            window.location.href = fullUrl;
        });
    } else {
        window.location.href = fullUrl;
    }
}

function openAdminLogin() {
    document.getElementById('adminLoginModal').classList.add('show');
    
    const visitorData = JSON.parse(localStorage.getItem('visitorData') || '{}');
    if (visitorData.visitorNumber) {
        database.ref('visitors').child(visitorData.visitorNumber).update({
            adminLoginAttempts: (visitorData.adminLoginAttempts || 0) + 1,
            lastAdminLoginAttempt: new Date().toISOString()
        });
    }
}

// ===== التركيز على زر العرض العائم - تم التعديل =====
function focusOnDisplayButton() {
    const displayBtn = document.getElementById('floatingDisplayBtn');
    if (displayBtn) {
        displayBtn.style.boxShadow = '0 0 0 3px rgba(52, 152, 219, 0.5), 0 8px 25px rgba(52, 152, 219, 0.5)';
        displayBtn.style.transform = 'scale(1.1)';
        displayBtn.style.transition = 'all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
        
        setTimeout(() => {
            displayBtn.style.boxShadow = '0 8px 25px rgba(52, 152, 219, 0.5)';
            displayBtn.style.transform = 'scale(1)';
        }, 3000);
        
        console.log('🎯 تم التركيز على زر العرض العائم');
    }
}

function installAppDirect() {
    downloadAppDirect();
}

// ===== نظام القائمة المنسدلة =====
function setupDropdownMenu() {
    const menuToggleBtn = document.getElementById('menuToggleBtn');
    const settingsMenu = document.getElementById('settingsMenu');
    
    if (menuToggleBtn && settingsMenu) {
        menuToggleBtn.addEventListener('click', function() {
            settingsMenu.classList.toggle('show');
            
            const span = menuToggleBtn.querySelector('.btn-text');
            if (settingsMenu.classList.contains('show')) {
                span.textContent = 'إغلاق القائمة الرئيسية';
            } else {
                span.textContent = 'القائمة الرئيسية';
            }
        });
        
        document.addEventListener('click', function(event) {
            if (!menuToggleBtn.contains(event.target) && !settingsMenu.contains(event.target)) {
                settingsMenu.classList.remove('show');
                const span = menuToggleBtn.querySelector('.btn-text');
                span.textContent = 'القائمة الرئيسية';
            }
        });
    }
}

// ===== إعداد تسجيل الدخول للإدارة =====
function setupAdminLogin() {
    const modal = document.getElementById('adminLoginModal');
    const closeBtn = document.getElementById('closeAdminLogin');
    const form = document.getElementById('adminLoginForm');
    const usernameInput = document.getElementById('adminUsername');
    const passwordInput = document.getElementById('adminPassword');
    const togglePassword = document.getElementById('toggleAdminPassword');
    const loginBtn = document.getElementById('adminLoginBtn');
    const spinner = document.getElementById('adminLoadingSpinner');
    const messageDiv = document.getElementById('adminLoginMessage');
    
    closeBtn.addEventListener('click', () => {
        modal.classList.remove('show');
        form.reset();
        messageDiv.style.display = 'none';
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('show');
            form.reset();
            messageDiv.style.display = 'none';
        }
    });
    
    togglePassword.addEventListener('click', () => {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        togglePassword.classList.toggle('fa-eye');
        togglePassword.classList.toggle('fa-eye-slash');
    });
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = usernameInput.value.trim();
        const password = passwordInput.value;
        
        loginBtn.disabled = true;
        spinner.style.display = 'inline-block';
        messageDiv.style.display = 'none';
        
        try {
            if (!username || !password) {
                throw new Error('يرجى ملء جميع الحقول');
            }
            
            const adminSnapshot = await database.ref('admins').child(username).once('value');
            const adminData = adminSnapshot.val();
            
            if (!adminData) {
                throw new Error('اسم المستخدم غير صحيح');
            }
            
            if (adminData.password !== password) {
                throw new Error('كلمة المرور غير صحيحة');
            }

            const userDataToStore = {
                id: username,
                username: username,
                name: adminData.name || username,
                type: 'admin',
                loginTime: new Date().toISOString()
            };
            
            globalUser.setUserData(userDataToStore);
            
            messageDiv.textContent = 'تم تسجيل الدخول بنجاح! جاري التوجيه...';
            messageDiv.className = 'login-message success-message';
            messageDiv.style.display = 'block';
            
            form.reset();
            
            setTimeout(() => {
                modal.classList.remove('show');
                window.location.href = '/Call/mnjr_admin.html';
            }, 1500);
            
        } catch (error) {
            messageDiv.textContent = error.message;
            messageDiv.className = 'login-message error-message';
            messageDiv.style.display = 'block';
        } finally {
            loginBtn.disabled = false;
            spinner.style.display = 'none';
        }
    });
}

// ===== نظام شريط الإعلانات =====
function setupAdBanner() {
    const adBanner = document.getElementById('adBanner');
    const adContent = document.querySelector('.ad-content');
    
    if (adBanner && adContent) {
        setTimeout(() => {
            adBanner.style.animation = 'footerSlideUp 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
        }, 2500);
        
        const adTexts = [
            'تطبيق AZ السوق الشامل - أفضل منصة للتسوق الإلكتروني في اليمن',
            'للإعلان على الموقع: 772299420',
            'تسوق بسهولة وأمان مع AZ السوق الشامل',
            'خدمات متكاملة للتسوق الإلكتروني والخدمات التجارية',
            'AZ السوق الشامل - لتلبية احتياجك بالكامل'
        ];
        
        let currentAdIndex = 0;
        setInterval(() => {
            currentAdIndex = (currentAdIndex + 1) % adTexts.length;
            adContent.innerHTML = `
                <i class="fas fa-ad"></i>
                <span>${adTexts[currentAdIndex]}</span>
                <i class="fas fa-star"></i>
                <span>للإعلان على الموقع: 772299420</span>
            `;
        }, 10000);
    }
}

// ===== دالة منفصلة للرسوم المتحركة =====
function setupPageAnimations() {
    const header = document.getElementById('mainHeader');
    const boxes = document.querySelectorAll('.box');
    const buttons = document.querySelectorAll('.btn');
    const footerMarquee = document.getElementById('footerMarquee');

    if (header) {
        setTimeout(() => {
            header.style.animation = 'headerEntrance 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
        }, 200);
    }

    if (boxes.length > 0) {
        boxes.forEach((box, index) => {
            setTimeout(() => {
                box.style.animation = 'boxFall 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
            }, 600 + index * 200);
        });
    }

    if (buttons.length > 0) {
        buttons.forEach((btn, index) => {
            setTimeout(() => {
                btn.style.animation = 'btnEntrance 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
            }, 1400 + index * 80);
        });
    }

    if (footerMarquee) {
        setTimeout(() => {
            footerMarquee.style.animation = 'footerSlideUp 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
        }, 2000 + buttons.length * 80);
    }
}

// ===== أحداث تحميل الصفحة والتفاعل - مصححة =====
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 بدء تحميل تطبيق AZ السوق الشامل');
    
    try {
        pwaDetector = new PWAInstallationDetector();
        const merchantMonitor = new MerchantMonitor();
        const joinNotification = new JoinRequestNotification();
        
        setupDropdownMenu();
        setupAdminLogin();
        setupAdBanner();
        setupInstallChoice();
        setupShareModal();
        
        const floatingInstallBtn = document.getElementById('floatingInstallBtn');
        if (floatingInstallBtn) {
            floatingInstallBtn.addEventListener('click', showInstallChoice);
        }
        
        setupPageAnimations();
        
        setTimeout(async () => {
            try {
                await visitorTracker.startTracking();
            } catch (error) {
                console.error('❌ فشل في بدء تتبع الزوار:', error);
            }
        }, 2000);
        
    } catch (error) {
        console.error('❌ خطأ في تهيئة التطبيق:', error);
    }
});

// النص المتحرك في التذييل
const footerScrollingText = document.getElementById('footerScrollingText');
const texts = [
    "🌟 الراعي الرسمي لهذا المتجر المميز سوفت للأنظمة المحاسبية المتكاملة - أول نظام محاسبي يصنع حسب الطلب - للطلب والاستفسار اتصل على 772299420",
    "💼 نظام محاسبي متكامل ومخصص حسب احتياجاتك - المميز سوفت - اتصل اطلبه الآن ولا تتردد 772299420",
    "🎯 مرحباً بكم في AZ السوق الشامل - خدماتنا متاحة على مدار الساعة - للدعم الفني 772299420",
    "⚡ تطبيق AZ - تجربة تسوق فريدة ومميزة - حمل التطبيق الآن واستمتع بأفضل العروض"
];

let currentTextIndex = 0;
setInterval(() => {
    currentTextIndex = (currentTextIndex + 1) % texts.length;
    if (footerScrollingText) {
        footerScrollingText.style.opacity = '0.6';
        footerScrollingText.style.transform = 'scale(0.95)';
        
        setTimeout(() => {
            footerScrollingText.textContent = texts[currentTextIndex];
            footerScrollingText.style.opacity = '1';
            footerScrollingText.style.transform = 'scale(1)';
        }, 300);
    }
}, 10000);

// تأثيرات الصناديق عند التمرير
const boxes = document.querySelectorAll('.box');
boxes.forEach(box => {
    box.addEventListener('mouseenter', () => {
        box.style.transform = 'translateY(-15px) rotateX(0deg) scale(1.03)';
        box.style.boxShadow = '0 25px 50px rgba(0,0,0,0.25)';
    });
    
    box.addEventListener('mouseleave', () => {
        box.style.transform = 'translateY(0) rotateX(0deg) scale(1)';
        box.style.boxShadow = '0 15px 35px rgba(0,0,0,0.15)';
    });
});

// Service Worker للتطبيق
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/Call/sw.js')
            .then((registration) => {
                console.log('✅ Service Worker مسجل بنجاح:', registration);
            })
            .catch((error) => {
                console.log('❌ فشل تسجيل Service Worker:', error);
            });
    });
}

// ===== معالجة الأخطاء العامة المحسنة =====
window.addEventListener('error', (event) => {
    console.error('❌ خطأ في الصفحة:', event.error);
    
    try {
        const visitorData = JSON.parse(localStorage.getItem('visitorData') || '{}');
        if (visitorData.visitorNumber) {
            database.ref('errors').push({
                visitorNumber: visitorData.visitorNumber,
                error: event.error?.toString() || 'خطأ غير معروف',
                url: window.location.href,
                timestamp: new Date().toISOString()
            });
        }
    } catch (e) {
        console.error('❌ فشل في تسجيل الخطأ:', e);
    }
});

window.addEventListener('unhandledrejection', (event) => {
    console.error('❌ وعد مرفوض:', event.reason);
    
    try {
        const visitorData = JSON.parse(localStorage.getItem('visitorData') || '{}');
        if (visitorData.visitorNumber) {
            database.ref('promise_rejections').push({
                visitorNumber: visitorData.visitorNumber,
                reason: event.reason?.toString() || 'سبب غير معروف',
                timestamp: new Date().toISOString()
            });
        }
    } catch (e) {
        console.error('❌ فشل في تسجيل الرفض:', e);
    }
});

// اختصار لوحة المفاتيح لفتح نافذة المشاركة (Ctrl+Shift+S)
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey && e.key === 'S') {
        e.preventDefault();
        openShareModal();
    }
});
</script>

</body>
</html>
