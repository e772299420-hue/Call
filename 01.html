<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Open Graph Tags Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_AR">
    <meta property="og:site_name" content="AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    <meta property="og:title" id="og-title" content="AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ - Ù…Ù†ØªØ¬Ø§Øª ÙˆØ¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©">
    <meta property="og:description" id="og-description" content="Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ Ù…Ù† AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„">
    <meta property="og:image" id="og-image" content="https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png">
    <meta property="og:url" id="og-url" content="https://e772299420-hue.github.io/facebook_share.html">
    
    <title id="page-title">AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ - Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ</title>
    
    <!-- ÙˆØµÙ Ø§Ù„ØµÙØ­Ø© -->
    <meta name="description" content="Ø´Ø§Ø±Ùƒ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ Ù…Ù† AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ ÙˆÙˆØ§ØªØ³Ø§Ø¨">
    <meta name="keywords" content="AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„, ÙÙŠØ³Ø¨ÙˆÙƒ, Ù…Ø´Ø§Ø±ÙƒØ©, Ù…Ù†ØªØ¬Ø§Øª, Ø¹Ø±ÙˆØ¶, ØªØ³ÙˆÙ‚">
    <meta name="author" content="AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„">
    
    <!-- Ø±Ø¨Ø· Ù…ÙƒØªØ¨Ø§Øª Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #1877F2;
            --secondary-color: #4267B2;
            --success-color: #42b72a;
            --dark-color: #1c1e21;
            --light-color: #f0f2f5;
            --border-radius: 12px;
            --box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding-top: 20px;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .main-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 0;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .brand-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .brand-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 20px;
            background: white;
            padding: 10px;
            border: 3px solid white;
        }

        .brand-text h1 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .brand-text p {
            opacity: 0.9;
            font-size: 16px;
        }

        /* Ø§Ù„ÙÙ„ØªØ±Ø© */
        .filter-section {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-control, .form-select {
            border: 2px solid #e1e5eb;
            border-radius: 10px;
            padding: 12px 15px;
        }

        .btn {
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
        }

        /* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ */
        .product-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid transparent;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .product-image-container {
            position: relative;
            width: 100%;
            height: 250px;
            overflow: hidden;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--success-color);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .product-content {
            padding: 25px;
        }

        .product-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .product-price {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product-description {
            color: #65676b;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© */
        .share-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-facebook-share {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-weight: 700;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-facebook-share:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(24, 119, 242, 0.4);
        }

        .btn-whatsapp-share {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-weight: 700;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-whatsapp-share:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4);
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© */
        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .share-modal.active {
            display: flex;
        }

        .share-modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .share-modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
        }

        .share-modal-body {
            padding: 30px;
        }

        .share-preview-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 3px solid var(--primary-color);
        }

        .share-text-preview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            white-space: pre-line;
            line-height: 1.8;
        }

        .share-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        @media (max-width: 576px) {
            .share-actions {
                grid-template-columns: 1fr;
            }
        }

        /* Ø§Ù„ÙÙˆØªØ± */
        .main-footer {
            background: var(--dark-color);
            color: white;
            padding: 40px 0;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            margin-top: 60px;
        }

        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
            }
        }

        .notification.success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .notification.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        /* Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-state {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f0f2f5;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
    </style>
</head>
<body>
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="main-header">
        <div class="container">
            <div class="brand-section">
                <img src="https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png" 
                     alt="Ø´Ø¹Ø§Ø± AZ" 
                     class="brand-logo">
                <div class="brand-text">
                    <h1>AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„</h1>
                    <p>Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ - ÙˆØµÙ„ Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø¥Ù„Ù‰ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Ø§Ù„ÙÙ„ØªØ±Ø© -->
    <section class="filter-section">
        <div class="container">
            <div class="filter-grid">
                <div>
                    <label class="form-label">Ø§Ù„ÙØ¦Ø©</label>
                    <select class="form-select" id="categoryFilter">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                    </select>
                </div>
                <div>
                    <label class="form-label">Ø§Ù„ØªØ§Ø¬Ø±</label>
                    <select class="form-select" id="merchantFilter">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¬Ø§Ø±</option>
                    </select>
                </div>
                <div>
                    <label class="form-label">Ø§Ù„Ø¨Ø­Ø«</label>
                    <input type="text" class="form-control" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
                </div>
                <div>
                    <label class="form-label">Ø§Ù„ØªØ±ØªÙŠØ¨</label>
                    <select class="form-select" id="sortFilter">
                        <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
                        <option value="price_low">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„</option>
                        <option value="price_high">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰</option>
                    </select>
                </div>
            </div>
            <div class="d-flex gap-3">
                <button class="btn btn-primary" id="applyFilters">
                    <i class="fas fa-filter"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
                </button>
                <button class="btn btn-outline-secondary" id="resetFilters">
                    <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
            </div>
        </div>
    </section>

    <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <section class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">
                <i class="fas fa-box-open text-primary"></i>
                Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
            </h2>
            <span class="badge bg-primary fs-6" id="productsCount">0 Ù…Ù†ØªØ¬</span>
        </div>
        
        <div id="productsContainer">
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <p class="mt-3 text-primary fs-5">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
            </div>
        </div>
    </section>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© -->
    <div class="share-modal" id="shareModal">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <h3 class="text-white mb-0">
                    <i class="fab fa-facebook me-2"></i>
                    Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ
                </h3>
            </div>
            <div class="share-modal-body">
                <img id="sharePreviewImage" 
                     class="share-preview-image" 
                     alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬"
                     src="https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png">
                
                <div class="share-text-preview" id="sharePreviewText">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬...
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:</label>
                    <div class="input-group">
                        <input type="text" 
                               class="form-control" 
                               id="sharePreviewUrl" 
                               readonly
                               value="Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·...">
                        <button class="btn btn-outline-primary" id="copyLinkBtn">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="share-actions">
                    <button class="btn btn-primary" id="shareOnFacebookBtn">
                        <i class="fab fa-facebook-f me-2"></i>
                        Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ
                    </button>
                    <button class="btn btn-success" id="shareOnWhatsappBtn">
                        <i class="fab fa-whatsapp me-2"></i>
                        Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨
                    </button>
                </div>
                
                <div class="mt-4 text-center text-muted">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        Ø³ÙŠØ¸Ù‡Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ÙƒØ§Ù…Ù„Ø§Ù‹ Ù…Ø¹ ØµÙˆØ±ØªÙ‡ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„ÙÙˆØªØ± -->
    <footer class="main-footer">
        <div class="container text-center">
            <img src="https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png" 
                 alt="Ø´Ø¹Ø§Ø± AZ" 
                 width="60" 
                 height="60"
                 class="mb-3">
            <p class="mb-2">Â© 2024 AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            <p class="mb-3 opacity-75">Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„ØªÙ„Ø¨ÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ø§Ù„ØªØ³ÙˆÙ‚ÙŠØ©</p>
            <a href="az_suq.html" class="btn btn-primary">
                <i class="fas fa-arrow-left me-2"></i>
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </a>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ==========================================
        // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Firebase
        // ==========================================
        const firebaseConfig = {
            databaseURL: "https://chat-fat-free-default-rtdb.firebaseio.com/"
        };

        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                console.log('âœ… Firebase initialized successfully');
            }
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:", error);
        }

        const db = firebase.database();

        // ==========================================
        // ğŸ“¦ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ==========================================
        let allProducts = [];
        let allMerchants = [];
        let allCategories = [];
        let filteredProducts = [];
        let currentProductForShare = null;
        let currentShareUrl = '';

        // ==========================================
        // ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ø±Ù Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('productId');
            
            if (productId) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ø±Ù Ù…Ù†ØªØ¬ØŒ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø¨Ø§Ø´Ø±Ø©
                openProductShareModal(productId);
            } else {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                loadAllData();
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            setupEventListeners();
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Open Graph Tags Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø·
            handleOpenGraphTags();
        });

        // ==========================================
        // ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        // ==========================================
        async function loadAllData() {
            try {
                const [productsSnap, merchantsSnap, categoriesSnap] = await Promise.all([
                    db.ref("products").once("value"),
                    db.ref("merchants").once("value"),
                    db.ref("categories").once("value")
                ]);

                allProducts = convertFirebaseData(productsSnap.val()) || [];
                allMerchants = convertFirebaseData(merchantsSnap.val()) || [];
                allCategories = convertFirebaseData(categoriesSnap.val()) || [];

                console.log('ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', {
                    products: allProducts.length,
                    merchants: allMerchants.length,
                    categories: allCategories.length
                });

                // ØªØµÙÙŠØ© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
                filterActiveProducts();
                
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙ„Ø§ØªØ±
                populateFilters();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                displayProducts();

            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        // ==========================================
        // ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Firebase
        // ==========================================
        function convertFirebaseData(firebaseData) {
            if (!firebaseData) return [];
            try {
                return Object.entries(firebaseData).map(([id, data]) => {
                    return { id, ...data };
                });
            } catch (e) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", e);
                return [];
            }
        }

        // ==========================================
        // ğŸª ØªØµÙÙŠØ© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†
        // ==========================================
        function filterActiveProducts() {
            filteredProducts = allProducts.filter(product => {
                const merchant = allMerchants.find(m => m.id === product.userId);
                if (!merchant) return false;
                
                const isActive = merchant.status === "active" || merchant.status === "Ù†Ø´Ø·";
                const isMerchant = merchant.job === "ØªØ§Ø¬Ø±" || merchant.type === "ØªØ§Ø¬Ø±";
                const hasImages = extractProductImages(product).length > 0;
                
                return isActive && isMerchant && hasImages;
            });
        }

        // ==========================================
        // ğŸ–¼ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬
        // ==========================================
        function extractProductImages(product) {
            const images = [];
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„ØµÙˆØ±
            const imageFields = ['image', 'imageUrl', 'imageUrls', 'images', 'photo', 'photos'];
            
            imageFields.forEach(field => {
                if (product[field]) {
                    if (Array.isArray(product[field])) {
                        product[field].forEach(img => {
                            if (img && img.trim() !== '') {
                                images.push(img.trim());
                            }
                        });
                    } else if (typeof product[field] === 'string') {
                        const splitImages = product[field].split(/[,\n]/)
                            .map(img => img.trim())
                            .filter(img => img !== '');
                        
                        images.push(...splitImages);
                    }
                }
            });
            
            // ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ØµÙˆØ±
            if (images.length === 0) {
                images.push('https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png');
            }
            
            return images;
        }

        // ==========================================
        // ğŸ”— ØªÙ†Ø³ÙŠÙ‚ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©
        // ==========================================
        function formatImageUrl(url) {
            if (!url) return 'https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png';
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø· Google Drive
            if (url.includes('drive.google.com')) {
                let fileId = '';
                
                if (url.includes('/d/')) {
                    fileId = url.split('/d/')[1].split('/')[0];
                } else if (url.includes('id=')) {
                    fileId = url.split('id=')[1].split('&')[0];
                }
                
                if (fileId) {
                    return `https://drive.google.com/thumbnail?id=${fileId}&sz=w1200`;
                }
            }
            
            return url;
        }

        // ==========================================
        // ğŸ“‹ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙ„Ø§ØªØ±
        // ==========================================
        function populateFilters() {
            // Ø§Ù„ÙØ¦Ø§Øª
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>';
            
            allCategories.forEach(category => {
                if (category.name && category.id) {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categoryFilter.appendChild(option);
                }
            });

            // Ø§Ù„ØªØ¬Ø§Ø±
            const merchantFilter = document.getElementById('merchantFilter');
            merchantFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¬Ø§Ø±</option>';
            
            const merchantsMap = new Map();
            filteredProducts.forEach(product => {
                const merchant = allMerchants.find(m => m.id === product.userId);
                if (merchant && merchant.name) {
                    merchantsMap.set(merchant.id, merchant.name);
                }
            });
            
            Array.from(merchantsMap.entries())
                .sort((a, b) => a[1].localeCompare(b[1]))
                .forEach(([id, name]) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = name;
                    merchantFilter.appendChild(option);
                });
        }

        // ==========================================
        // ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        // ==========================================
        function setupEventListeners() {
            // Ø§Ù„ÙÙ„Ø§ØªØ±
            document.getElementById('applyFilters').addEventListener('click', applyFilters);
            document.getElementById('resetFilters').addEventListener('click', resetFilters);
            
            // Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
            document.getElementById('copyLinkBtn').addEventListener('click', copyShareLink);
            document.getElementById('shareOnFacebookBtn').addEventListener('click', shareOnFacebook);
            document.getElementById('shareOnWhatsappBtn').addEventListener('click', shareOnWhatsapp);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            document.getElementById('shareModal').addEventListener('click', (e) => {
                if (e.target.id === 'shareModal') {
                    closeShareModal();
                }
            });
            
            // Ø§Ø®ØªØµØ§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeShareModal();
                }
            });
        }

        // ==========================================
        // ğŸ¨ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        // ==========================================
        function displayProducts(products = filteredProducts) {
            const container = document.getElementById('productsContainer');
            const countElement = document.getElementById('productsCount');
            
            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open fa-4x text-muted mb-4"></i>
                        <h3 class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h3>
                        <p class="text-muted mb-4">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
                    </div>
                `;
                countElement.textContent = '0 Ù…Ù†ØªØ¬';
                return;
            }

            const productsHTML = products.map(product => {
                const merchant = allMerchants.find(m => m.id === product.userId);
                const category = allCategories.find(c => c.id === product.categoryId);
                const images = extractProductImages(product);
                const mainImage = formatImageUrl(images[0]);
                
                const price = product.price ? 
                    `${parseFloat(product.price).toLocaleString('ar-EG')} ${product.currency || 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ'}` : 
                    'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                
                const shortDescription = product.description ? 
                    (product.description.length > 120 ? 
                        product.description.substring(0, 120) + '...' : 
                        product.description) : 
                    'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
                
                return `
                    <div class="product-card">
                        <div class="product-image-container">
                            <img src="${mainImage}" 
                                 alt="${product.name || 'Ù…Ù†ØªØ¬'}" 
                                 class="product-image"
                                 loading="lazy">
                            ${product.productType === 'Ø¹Ø±Ø¶' ? 
                                '<div class="product-badge"><i class="fas fa-tag"></i> Ø¹Ø±Ø¶ Ø®Ø§Øµ</div>' : ''}
                        </div>
                        <div class="product-content">
                            <h3 class="product-title">${product.name || 'Ù…Ù†ØªØ¬ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h3>
                            <div class="product-price">
                                <i class="fas fa-money-bill-wave"></i>
                                ${price}
                            </div>
                            <p class="product-description">${shortDescription}</p>
                            
                            ${merchant ? `
                                <div class="d-flex align-items-center gap-3 mb-3 p-3 bg-light rounded">
                                    <img src="https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png" 
                                         alt="${merchant.name}" 
                                         width="40" 
                                         height="40"
                                         class="rounded-circle">
                                    <div>
                                        <div class="fw-bold">${merchant.name || merchant.username}</div>
                                        <small class="text-muted">${merchant.governorate || ''}</small>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="share-buttons">
                                <button class="btn-facebook-share" onclick="openShareModal('${product.id}')">
                                    <i class="fab fa-facebook-f"></i>
                                    Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ
                                </button>
                                <button class="btn-whatsapp-share" onclick="shareOnWhatsAppDirect('${product.id}')">
                                    <i class="fab fa-whatsapp"></i>
                                    Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <div class="products-grid">
                    ${productsHTML}
                </div>
            `;
            
            countElement.textContent = `${products.length} Ù…Ù†ØªØ¬`;
        }

        // ==========================================
        // ğŸ” ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
        // ==========================================
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryId = document.getElementById('categoryFilter').value;
            const merchantId = document.getElementById('merchantFilter').value;
            const sortBy = document.getElementById('sortFilter').value;

            let filtered = [...filteredProducts];

            // Ø§Ù„Ø¨Ø­Ø«
            if (searchTerm) {
                filtered = filtered.filter(product => {
                    const productName = (product.name || '').toLowerCase();
                    const productDesc = (product.description || '').toLowerCase();
                    const merchant = allMerchants.find(m => m.id === product.userId);
                    const merchantName = (merchant?.name || '').toLowerCase();
                    
                    return productName.includes(searchTerm) || 
                           productDesc.includes(searchTerm) || 
                           merchantName.includes(searchTerm);
                });
            }

            // Ø§Ù„ÙØ¦Ø©
            if (categoryId) {
                filtered = filtered.filter(product => product.categoryId === categoryId);
            }

            // Ø§Ù„ØªØ§Ø¬Ø±
            if (merchantId) {
                filtered = filtered.filter(product => product.userId === merchantId);
            }

            // Ø§Ù„ØªØ±ØªÙŠØ¨
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'price_low':
                        return (parseFloat(a.price) || 0) - (parseFloat(b.price) || 0);
                    case 'price_high':
                        return (parseFloat(b.price) || 0) - (parseFloat(a.price) || 0);
                    case 'newest':
                    default:
                        const dateA = new Date(a.publishDate || a.createdAt || a.date || 0);
                        const dateB = new Date(b.publishDate || b.createdAt || b.date || 0);
                        return dateB - dateA;
                }
            });

            displayProducts(filtered);
        }

        // ==========================================
        // ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
        // ==========================================
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('merchantFilter').value = '';
            document.getElementById('sortFilter').value = 'newest';
            
            applyFilters();
            showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±', 'success');
        }

        // ==========================================
        // ğŸ“¤ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        // ==========================================
        function openShareModal(productId) {
            const product = filteredProducts.find(p => p.id === productId);
            if (!product) {
                showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }

            currentProductForShare = product;
            prepareShareData(product);
            document.getElementById('shareModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // ØªØ­Ø¯ÙŠØ« Open Graph Tags
            updateOpenGraphTags(product);
        }

        // ==========================================
        // ğŸ“¥ Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        // ==========================================
        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
            document.body.style.overflow = '';
            currentProductForShare = null;
        }

        // ==========================================
        // ğŸ“ ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        // ==========================================
        function prepareShareData(product) {
            const merchant = allMerchants.find(m => m.id === product.userId);
            const category = allCategories.find(c => c.id === product.categoryId);
            const images = extractProductImages(product);
            const mainImage = formatImageUrl(images[0]);
            
            // ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            document.getElementById('sharePreviewImage').src = mainImage;
            document.getElementById('sharePreviewImage').alt = product.name || 'Ù…Ù†ØªØ¬';
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Øµ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
            const productName = product.name || 'Ù…Ù†ØªØ¬ Ø±Ø§Ø¦Ø¹';
            const productPrice = product.price ? 
                `${parseFloat(product.price).toLocaleString('ar-EG')} ${product.currency || 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ'}` : 
                'Ø³Ø¹Ø± Ù…Ù…ÙŠØ²';
            
            const shareText = `ğŸ›ï¸ ${productName} ğŸ›ï¸

ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${productPrice}
ğŸª Ø§Ù„ØªØ§Ø¬Ø±: ${merchant?.name || merchant?.username || 'ØªØ§Ø¬Ø±'}
ğŸ“‚ Ø§Ù„ÙØ¦Ø©: ${category?.name || 'Ù…ØªÙ†ÙˆØ¹'}

${product.description ? `ğŸ“ ${product.description}` : 'Ù…Ù†ØªØ¬ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©'}

ğŸŒŸ ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù† Ø¹Ø¨Ø± AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„`;

            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
            currentShareUrl = createShareUrl(product);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ±
            document.getElementById('sharePreviewText').textContent = shareText;
            document.getElementById('sharePreviewUrl').value = currentShareUrl;
        }

        // ==========================================
        // ğŸ”— Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        // ==========================================
        function createShareUrl(product) {
            const baseUrl = window.location.origin + window.location.pathname;
            const productId = product.id;
            const productName = encodeURIComponent(product.name || 'Ù…Ù†ØªØ¬');
            
            return `${baseUrl}?productId=${productId}&productName=${productName}&share=true`;
        }

        // ==========================================
        // ğŸ“‹ Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        // ==========================================
        function copyShareLink() {
            if (!currentShareUrl) {
                showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù„Ù„Ù†Ø³Ø®', 'error');
                return;
            }

            navigator.clipboard.writeText(currentShareUrl)
                .then(() => {
                    const btn = document.getElementById('copyLinkBtn');
                    const originalHTML = btn.innerHTML;
                    
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.classList.remove('btn-outline-primary');
                    btn.classList.add('btn-success');
                    
                    setTimeout(() => {
                        btn.innerHTML = '<i class="far fa-copy"></i>';
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-outline-primary');
                    }, 2000);
                    
                    showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
                })
                .catch(err => {
                    console.error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', err);
                    showNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·', 'error');
                });
        }

        // ==========================================
        // ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ Facebook
        // ==========================================
        function shareOnFacebook() {
            if (!currentShareUrl || !currentProductForShare) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©', 'error');
                return;
            }

            const product = currentProductForShare;
            const productName = product.name || 'Ù…Ù†ØªØ¬ Ø±Ø§Ø¦Ø¹ Ù…Ù† AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„';
            
            // Ø±Ø§Ø¨Ø· Ù…Ø´Ø§Ø±ÙƒØ© Facebook Ù…Ø¹ Ù…Ø¹Ù„Ù…Ø§Øª Open Graph
            const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentShareUrl)}&quote=${encodeURIComponent(productName)}&hashtag=%23AZ_Ø§Ù„Ø³ÙˆÙ‚_Ø§Ù„Ø´Ø§Ù…Ù„`;
            
            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
            window.open(shareUrl, '_blank', 'width=700,height=600');
            
            closeShareModal();
            showNotification('Ø¬Ø§Ø±Ù ÙØªØ­ Facebook Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©...', 'success');
        }

        // ==========================================
        // ğŸ“± Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ WhatsApp
        // ==========================================
        function shareOnWhatsapp() {
            if (!currentShareUrl || !currentProductForShare) return;

            const product = currentProductForShare;
            const merchant = allMerchants.find(m => m.id === product.userId);
            
            const message = `ğŸ›ï¸ ${product.name || 'Ù…Ù†ØªØ¬ Ø±Ø§Ø¦Ø¹'} ğŸ›ï¸

ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${product.price ? `${product.price} ${product.currency || 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ'}` : 'Ø³Ø¹Ø± Ù…Ù…ÙŠØ²'}
ğŸª Ø§Ù„ØªØ§Ø¬Ø±: ${merchant?.name || merchant?.username || 'ØªØ§Ø¬Ø±'}

ğŸ“ ${product.description || 'Ù…Ù†ØªØ¬ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ù† AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„'}

ğŸ”— ${currentShareUrl}

#AZ_Ø§Ù„Ø³ÙˆÙ‚_Ø§Ù„Ø´Ø§Ù…Ù„ #ØªØ³ÙˆÙ‚`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            showNotification('Ø¬Ø§Ø±Ù ÙØªØ­ WhatsApp Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©...', 'success');
        }

        // ==========================================
        // ğŸ“± Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ WhatsApp
        // ==========================================
        function shareOnWhatsAppDirect(productId) {
            const product = filteredProducts.find(p => p.id === productId);
            if (!product) return;

            const merchant = allMerchants.find(m => m.id === product.userId);
            const images = extractProductImages(product);
            const mainImage = formatImageUrl(images[0]);
            
            const message = `ğŸ›ï¸ ${product.name || 'Ù…Ù†ØªØ¬ Ø±Ø§Ø¦Ø¹'} ğŸ›ï¸

ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${product.price ? `${product.price} ${product.currency || 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ'}` : 'Ø³Ø¹Ø± Ù…Ù…ÙŠØ²'}
ğŸª Ø§Ù„ØªØ§Ø¬Ø±: ${merchant?.name || merchant?.username || 'ØªØ§Ø¬Ø±'}

ğŸ“ ${product.description ? product.description.substring(0, 200) + (product.description.length > 200 ? '...' : '') : 'Ù…Ù†ØªØ¬ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©'}

ğŸ”— ${window.location.origin + window.location.pathname}?productId=${productId}

#AZ_Ø§Ù„Ø³ÙˆÙ‚_Ø§Ù„Ø´Ø§Ù…Ù„ #ØªØ³ÙˆÙ‚`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            showNotification('Ø¬Ø§Ø±Ù ÙØªØ­ WhatsApp Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©...', 'success');
        }

        // ==========================================
        // ğŸ·ï¸ ØªØ­Ø¯ÙŠØ« Open Graph Tags
        // ==========================================
        function updateOpenGraphTags(product) {
            const images = extractProductImages(product);
            const mainImage = formatImageUrl(images[0]);
            const description = product.description || 'Ù…Ù†ØªØ¬ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ù† AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„';
            const title = product.name || 'Ù…Ù†ØªØ¬ Ù…Ù† AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„';
            const url = window.location.origin + window.location.pathname + `?productId=${product.id}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ØµØ± Open Graph
            document.getElementById('og-title').setAttribute('content', title);
            document.getElementById('og-description').setAttribute('content', description);
            document.getElementById('og-image').setAttribute('content', mainImage);
            document.getElementById('og-url').setAttribute('content', url);
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
            document.getElementById('page-title').textContent = title;
            
            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Open Graph Tags:', { title, image: mainImage });
        }

        // ==========================================
        // ğŸ” Ù…Ø¹Ø§Ù„Ø¬Ø© Open Graph Tags Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        // ==========================================
        function handleOpenGraphTags() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('productId');
            
            if (productId) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ø±Ù Ù…Ù†ØªØ¬ØŒ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ù‡ ÙˆØªØ­Ø¯ÙŠØ« Open Graph Tags
                findProductById(productId).then(product => {
                    if (product) {
                        updateOpenGraphTags(product);
                        updatePageForProduct(product);
                    }
                });
            }
        }

        // ==========================================
        // ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ù…Ø¹Ø±Ù
        // ==========================================
        async function findProductById(productId) {
            try {
                const productSnap = await db.ref(`products/${productId}`).once('value');
                if (productSnap.exists()) {
                    return { id: productId, ...productSnap.val() };
                }
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ØŒ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                const productsSnap = await db.ref("products").once("value");
                const products = convertFirebaseData(productsSnap.val());
                return products.find(p => p.id === productId);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬:', error);
                return null;
            }
        }

        // ==========================================
        // ğŸ¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø­Ø¯Ø¯
        // ==========================================
        function updatePageForProduct(product) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡ÙŠØ¯Ø±
            const header = document.querySelector('.main-header');
            header.innerHTML = `
                <div class="container">
                    <div class="brand-section">
                        <img src="https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png" 
                             alt="Ø´Ø¹Ø§Ø± AZ" 
                             class="brand-logo">
                        <div class="brand-text">
                            <h1>${product.name || 'Ù…Ù†ØªØ¬'}</h1>
                            <p>Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ ÙˆÙˆØ§ØªØ³Ø§Ø¨</p>
                        </div>
                    </div>
                </div>
            `;
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const productsContainer = document.getElementById('productsContainer');
            const images = extractProductImages(product);
            const mainImage = formatImageUrl(images[0]);
            const merchant = allMerchants.find(m => m.id === product.userId);
            const price = product.price ? 
                `${parseFloat(product.price).toLocaleString('ar-EG')} ${product.currency || 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ'}` : 
                'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            productsContainer.innerHTML = `
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="${mainImage}" 
                                     alt="${product.name || 'Ù…Ù†ØªØ¬'}" 
                                     class="product-image">
                                ${product.productType === 'Ø¹Ø±Ø¶' ? 
                                    '<div class="product-badge"><i class="fas fa-tag"></i> Ø¹Ø±Ø¶ Ø®Ø§Øµ</div>' : ''}
                            </div>
                            <div class="product-content">
                                <h3 class="product-title">${product.name || 'Ù…Ù†ØªØ¬ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h3>
                                <div class="product-price">
                                    <i class="fas fa-money-bill-wave"></i>
                                    ${price}
                                </div>
                                <p class="product-description" style="-webkit-line-clamp: none; overflow: visible;">
                                    ${product.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}
                                </p>
                                
                                ${merchant ? `
                                    <div class="d-flex align-items-center gap-3 mb-4 p-3 bg-light rounded">
                                        <img src="https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png" 
                                             alt="${merchant.name}" 
                                             width="50" 
                                             height="50"
                                             class="rounded-circle">
                                        <div>
                                            <div class="fw-bold fs-5">${merchant.name || merchant.username}</div>
                                            <small class="text-muted">${merchant.governorate || ''}</small>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <div class="share-buttons">
                                    <button class="btn-facebook-share" onclick="shareCurrentProductOnFacebook()">
                                        <i class="fab fa-facebook-f"></i>
                                        Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ
                                    </button>
                                    <button class="btn-whatsapp-share" onclick="shareCurrentProductOnWhatsApp()">
                                        <i class="fab fa-whatsapp"></i>
                                        Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙ„ØªØ±Ø©
            document.querySelector('.filter-section').style.display = 'none';
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ø¯Ø§Ø¯
            document.getElementById('productsCount').style.display = 'none';
        }

        // ==========================================
        // ğŸ“¤ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ
        // ==========================================
        function openProductShareModal(productId) {
            findProductById(productId).then(product => {
                if (product) {
                    currentProductForShare = product;
                    
                    // ØªØ­Ø¯ÙŠØ« Open Graph Tags Ø£ÙˆÙ„Ø§Ù‹
                    updateOpenGraphTags(product);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬
                    updatePageForProduct(product);
                    
                    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·
                    setTimeout(() => {
                        prepareShareData(product);
                        document.getElementById('shareModal').classList.add('active');
                        document.body.style.overflow = 'hidden';
                    }, 500);
                } else {
                    showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    loadAllData(); // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ
                }
            });
        }

        // ==========================================
        // ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¹Ù„Ù‰ Facebook
        // ==========================================
        function shareCurrentProductOnFacebook() {
            if (!currentProductForShare) return;
            
            const product = currentProductForShare;
            const shareUrl = createShareUrl(product);
            const productName = product.name || 'Ù…Ù†ØªØ¬ Ø±Ø§Ø¦Ø¹ Ù…Ù† AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„';
            
            const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(productName)}&hashtag=%23AZ_Ø§Ù„Ø³ÙˆÙ‚_Ø§Ù„Ø´Ø§Ù…Ù„`;
            
            window.open(facebookUrl, '_blank', 'width=700,height=600');
            showNotification('Ø¬Ø§Ø±Ù ÙØªØ­ Facebook Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©...', 'success');
        }

        // ==========================================
        // ğŸ“± Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¹Ù„Ù‰ WhatsApp
        // ==========================================
        function shareCurrentProductOnWhatsApp() {
            if (!currentProductForShare) return;
            
            const product = currentProductForShare;
            const merchant = allMerchants.find(m => m.id === product.userId);
            const shareUrl = createShareUrl(product);
            
            const message = `ğŸ›ï¸ ${product.name || 'Ù…Ù†ØªØ¬ Ø±Ø§Ø¦Ø¹'} ğŸ›ï¸

ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${product.price ? `${product.price} ${product.currency || 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ'}` : 'Ø³Ø¹Ø± Ù…Ù…ÙŠØ²'}
ğŸª Ø§Ù„ØªØ§Ø¬Ø±: ${merchant?.name || merchant?.username || 'ØªØ§Ø¬Ø±'}

ğŸ“ ${product.description || 'Ù…Ù†ØªØ¬ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ù† AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„'}

ğŸ”— ${shareUrl}

#AZ_Ø§Ù„Ø³ÙˆÙ‚_Ø§Ù„Ø´Ø§Ù…Ù„ #ØªØ³ÙˆÙ‚`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
            showNotification('Ø¬Ø§Ø±Ù ÙØªØ­ WhatsApp Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©...', 'success');
        }

        // ==========================================
        // ğŸ”” Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        // ==========================================
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ==========================================
        // âŒ Ø¹Ø±Ø¶ Ø®Ø·Ø£
        // ==========================================
        function showError(message) {
            const container = document.getElementById('productsContainer');
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle fa-4x text-danger mb-4"></i>
                    <h3 class="text-danger">Ø­Ø¯Ø« Ø®Ø·Ø£</h3>
                    <p class="text-muted mb-4">${message}</p>
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-redo me-2"></i>
                        Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    </button>
                </div>
            `;
        }

        // ==========================================
        // ğŸŒ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ
        // ==========================================
        window.openShareModal = openShareModal;
        window.shareOnWhatsAppDirect = shareOnWhatsAppDirect;
        window.shareCurrentProductOnFacebook = shareCurrentProductOnFacebook;
        window.shareCurrentProductOnWhatsApp = shareCurrentProductOnWhatsApp;
        window.closeShareModal = closeShareModal;
        window.resetFilters = resetFilters;

        console.log('ğŸ‰ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø¬Ø§Ø­');
    </script>
</body>
    </html>
