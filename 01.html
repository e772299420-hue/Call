<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ - Ø³ÙˆÙ‚ ØªØ¬Ø§Ø±ÙŠ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø© ÙˆØ§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù</title>
    
    <!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¨Ø­Ø« -->
    <meta name="description" content="AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„ - Ù…Ù†ØµØ© ØªØ¬Ø§Ø±ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø©ØŒ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§ØªØŒ Ø§Ù„ÙˆØ¸Ø§Ø¦ÙØŒ ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… ÙˆØ§Ù„Ø¨ÙˆÙÙŠÙ‡Ø§ØªØŒ ÙˆØ£Ø±Ù‚Ø§Ù… Ù…Ù‡Ù…Ø© Ù„ØªÙ„Ø¨ÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ">
    <meta name="keywords" content="AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„, Ø³ÙˆÙ‚ ØªØ¬Ø§Ø±ÙŠ, Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©, Ù…Ù†ØªØ¬Ø§Øª Ù…Ø³ØªØ¹Ù…Ù„Ø©, Ø­Ø±Ø§Ø¬, Ø¹Ù‚Ø§Ø±Ø§Øª, Ø´Ù‚Ù‚ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±, ÙˆØ¸Ø§Ø¦Ù Ø´Ø§ØºØ±Ø©, ØªÙˆØµÙŠÙ„ Ø·Ø¹Ø§Ù…, Ù…Ø·Ø§Ø¹Ù…, Ø¨ÙˆÙÙŠÙ‡Ø§Øª, Ù„Ø­ÙˆÙ…, ØªØ³ÙˆÙ‚, ØªØ³ÙˆÙ‚ Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ, Ù…Ù†ØµØ© ØªØ¬Ø§Ø±ÙŠØ©, Ø³ÙˆÙ‚ Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ, Ø´Ø±Ø§Ø¡, Ø¨ÙŠØ¹, Ø¹Ø±ÙˆØ¶, Ù…ØªØ¬Ø± Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ, ØªØ¬Ø§Ø±Ø©, ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª, Ø³ÙˆÙ‚ Ø¹Ø±Ø¨ÙŠ, Ø³ÙˆÙ‚ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©, Ø³ÙˆÙ‚ Ø§Ù„Ø®Ù„ÙŠØ¬, Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·">
    <meta name="author" content="AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„">
    
    <!-- ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ø¨Ù„ØºØ§Øª Ù…Ø®ØªÙ„ÙØ© -->
    <meta name="keywords" content="AZ marketplace, online shopping, e-commerce, Saudi market, Gulf market, Middle East market, used products, real estate, jobs, food delivery">
    <meta name="keywords" content="AZ marchÃ© complet, shopping en ligne, commerce Ã©lectronique, marchÃ© saoudien, produits d'occasion, immobilier, emplois, livraison de nourriture">
    <meta name="keywords" content="AZ mercado completo, compras en lÃ­nea, comercio electrÃ³nico, mercado saudÃ­, productos usados, bienes raÃ­ces, empleos, entrega de comida">
    <meta name="keywords" content="AZ vollstÃ¤ndiger Markt, Online-Shopping, E-Commerce, saudischer Markt, gebrauchte Produkte, Immobilien, Jobs, Essenslieferung">
    <meta name="keywords" content="AZ å®Œå…¨å¸‚å ´, ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°, é›»å­å•†å–å¼•, ã‚µã‚¦ã‚¸å¸‚å ´, ä¸­å¤å“, ä¸å‹•ç”£, æ±‚äºº, ãƒ•ãƒ¼ãƒ‰ãƒ‡ãƒªãƒãƒªãƒ¼">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ==========================================
           ğŸ¯ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª
           ========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --background-color: #ffffff;
            --text-color: #333;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            --transition: all 0.25s ease;
        }

        [data-theme="dark"] {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --background-color: #121212;
            --text-color: #ecf0f1;
            --light-color: #2c3e50;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding-top: 128px;
            padding-bottom: 40px;
            transition: var(--transition);
            width: 100%;
            overflow-x: hidden;
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-overlay {
            display: none !important;
        }

        /* ==========================================
           ğŸ¯ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„ØµÙˆØ±
           ========================================== */
        .slider-image,
        .gallery-main-image,
        .gallery-thumbnail {
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000;
        }

        /* ==========================================
           ğŸ¯ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
           ========================================== */
        .card {
            transform: translateZ(0);
            will-change: transform;
        }

        /* ==========================================
           ğŸ¯ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ
           ========================================== */
        .header,
        .secondary-bar,
        .filter-bar {
            transform: translateZ(0);
            will-change: transform;
        }

        /* ==========================================
           ğŸ¯ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
           ========================================== */
        .footer-text {
            will-change: transform;
        }

        /* ==========================================
           ğŸ¯ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„Ø´Ø¨ÙƒØ©
           ========================================== */
        .products {
            contain: layout style paint;
        }

        /* ==========================================
           ğŸ¯ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªØµÙ…ÙŠÙ…
           ========================================== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            box-shadow: var(--box-shadow);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand-logo {
            width: 50px;
            height: 50px;
            object-fit: contain;
            border-radius: 10px;
            background: white;
            padding: 4px;
            border: 2px solid white;
        }

        .brand-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .brand-title {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
        }

        .brand-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        .header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .header-login {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
            cursor: pointer;
            text-decoration: none;
            order: 1;
        }

        .header-online-users {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
            cursor: pointer;
            order: 2;
        }

        .secondary-bar {
            position: fixed;
            top: 84px;
            left: 0;
            width: 100%;
            background: var(--dark-color);
            padding: 8px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 999;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            color: white;
        }

        .secondary-bar-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .secondary-bar-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .secondary-bar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .custom-combobox {
            position: relative;
            min-width: 150px;
        }

        .combobox-input {
            padding: 6px 10px;
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 14px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transition: var(--transition);
            width: 100%;
            text-align: right;
        }

        .combobox-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: var(--dark-color);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .combobox-dropdown.active {
            display: block;
        }

        .combobox-option {
            padding: 8px 12px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        .combobox-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .combobox-option.selected {
            background: var(--primary-color);
        }

        .filter-bar {
            position: fixed;
            top: 128px;
            left: 0;
            width: 100%;
            background: var(--light-color);
            padding: 10px 20px;
            display: none;
            flex-wrap: wrap;
            gap: 10px;
            z-index: 998;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            align-items: center;
            transition: var(--transition);
        }

        .filter-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-item label {
            font-weight: bold;
            font-size: 14px;
            white-space: nowrap;
        }

        .filter-item select, .filter-item input {
            padding: 6px 10px;
            border-radius: var(--border-radius);
            border: 1px solid #ccc;
            font-size: 14px;
            background: var(--background-color);
            color: var(--text-color);
            transition: var(--transition);
        }

        .search-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .search-container input {
            flex: 1;
        }

        .reset-btn {
            padding: 8px 12px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--primary-color);
            color: white;
            position: relative;
        }

        .page-content {
            width: 100%;
            max-width: 100%;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }

        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
            gap: 20px;
            padding: 10px;
            justify-content: center;
            width: 100%;
            box-sizing: border-box;
        }

        .card {
            background: linear-gradient(145deg, var(--background-color), #f0f0f1);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
            padding: 15px;
            transition: var(--transition);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: fit-content;
            width: 100%;
            box-sizing: border-box;
            border: 3px solid #3498db;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            border-color: #2980b9;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 4000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--background-color);
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            text-align: center;
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #3498db;
            color: white;
            text-align: center;
            padding: 8px 15px;
            z-index: 1000;
            font-size: 14px;
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            cursor: default;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-text {
            white-space: nowrap;
            position: relative;
            font-size: 16px;
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 20px;
            background: transparent;
            color: white;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
            overflow: visible;
            width: auto;
            max-width: 90%;
            margin: 0 auto;
            text-overflow: unset;
            line-height: 1.2;
            min-height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: slideText 15s linear infinite;
        }

        @keyframes slideText {
            0% {
                transform: translateX(-100%);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
        @media (max-width: 768px) {
            body { padding-top: 128px; padding-bottom: 40px; }
            .filter-bar { top: 128px; padding: 8px 10px; }
            .filter-item { flex: 1 0 100%; }
            .filter-item input { width: 100%; }
            .products { grid-template-columns: 1fr; }
            .brand-title { font-size: 16px; }
            .brand-subtitle { font-size: 11px; }
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ - Ù…Ø®ÙÙŠØ© -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loading-progress-bar"></div>
        </div>
    </div>

    <!-- ==========================================
       ğŸ¯ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
       ========================================== -->
    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø¯Ù… ØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª -->
    <div class="modal-overlay" id="no-data-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø©
                </div>
            </div>
            <div class="modal-body">
                <p>Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
                <p>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ± Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" id="edit-search-btn">
                    <i class="fas fa-sliders-h"></i>
                    ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø«
                </button>
                <button class="modal-btn primary" id="reset-filters-modal-btn">
                    <i class="fas fa-redo"></i>
                    Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
                </button>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="header">
        <div class="header-content">
            <!-- Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <div class="brand">
                <img src="https://raw.githubusercontent.com/e772299420-hue/Call/main/icon-512x5122.png" alt="Ø´Ø¹Ø§Ø± AZ" class="brand-logo">
                <div class="brand-text">
                    <div class="brand-title">AZ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ø§Ù…Ù„</div>
                    <div class="brand-subtitle">Ù„ØªÙ„Ø¨ÙŠØ© Ø§Ø­ØªÙŠØ§Ø¬Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</div>
                </div>
            </div>

            <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† ÙÙŠ Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
            <div class="header-right">
                <a href="manjr_tagr_snf.html" class="header-login" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„">
                    <i class="fas fa-sign-in-alt"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </a>
                
                <div class="header-online-users" id="header-online-users">
                    <i class="fas fa-users"></i>
                    <span id="header-users-count">0</span> Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†
                </div>
            </div>
        </div>
    </header>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <div class="secondary-bar">
        <div class="secondary-bar-content">
            <div class="secondary-bar-left">
                <!-- ComboBox Ù„Ù„Ù‚Ø³Ù… -->
                <div class="secondary-category">
                    <div class="category-search-container">
                        <div class="custom-combobox" id="secondary-category-combobox">
                            <input type="text" class="combobox-input" id="secondary-category-input" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…..." value="">
                            <div class="combobox-dropdown" id="secondary-category-dropdown">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                <div class="products-count">
                    <i class="fas fa-box"></i>
                    <span id="products-count"> : 0</span>
                </div>

                <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ -->
                <div class="online-users-real">
                    <i class="fas fa-user-clock"></i>
                    <span id="real-online-users">0</span>
                </div>
            </div>

            <div class="secondary-bar-right">
                <!-- Ø²Ø± Ø¹Ø±Ø¶ Ø£ÙƒØ«Ø± -->
                <button class="show-more-btn" id="show-more-btn">
                    <i class="fas fa-bars"></i>
                    Ø¹Ø±Ø¶ Ø£ÙƒØ«Ø±
                </button>

                <!-- Ø²Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø© -->
                <button class="secondary-favorites" id="secondary-favorites" title="Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¶Ù„Ø©">
                    <i class="fas fa-heart"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± - Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ -->
    <div class="filter-bar" id="filter-bar">
        <!-- ComboBox Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø© -->
        <div class="filter-item">
            <label for="governorate">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</label>
            <div class="custom-combobox" id="governorate-combobox">
                <input type="text" class="combobox-input" id="governorate-input" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©..." value="">
                <div class="combobox-dropdown" id="governorate-dropdown">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>

        <!-- ComboBox Ù„Ù„Ù…Ù†Ø·Ù‚Ø© -->
        <div class="filter-item">
            <label for="region">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</label>
            <div class="custom-combobox" id="region-combobox">
                <input type="text" class="combobox-input" id="region-input" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©..." value="">
                <div class="combobox-dropdown" id="region-dropdown">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
        
        <!-- ComboBox Ù„Ù„ØªØ§Ø¬Ø± -->
        <div class="filter-item">
            <label for="merchant">Ø§Ù„ØªØ§Ø¬Ø±:</label>
            <div class="custom-combobox" id="merchant-combobox">
                <input type="text" class="combobox-input" id="merchant-input" placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø¬Ø±..." value="">
                <div class="combobox-dropdown" id="merchant-dropdown">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>

        <!-- ComboBox Ù„Ù„Ù‚Ø³Ù… ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± -->
        <div class="filter-item">
            <label for="category">Ø§Ù„Ù‚Ø³Ù…:</label>
            <div class="custom-combobox" id="category-combobox">
                <input type="text" class="combobox-input" id="category-input" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…..." value="">
                <div class="combobox-dropdown" id="category-dropdown">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>

        <!-- Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« -->
        <div class="filter-item">
            <label for="search">Ø¨Ø­Ø«:</label>
            <div class="search-container">
                <input type="text" id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
            </div>
        </div>

        <div class="filter-item">
            <label for="sort-by">ØªØ±ØªÙŠØ¨:</label>
            <select id="sort-by">
                <option value="date">Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)</option>
                <option value="name">Ø§Ù„Ø§Ø³Ù…</option>
                <option value="category">Ø§Ù„Ù‚Ø³Ù…</option>
                <option value="price">Ø§Ù„Ø³Ø¹Ø±</option>
                <option value="merchant">Ø§Ù„ØªØ§Ø¬Ø±</option>
                <option value="preference">Ø±ØºØ¨ØªÙŠ</option>
                <option value="offers">Ø§Ù„Ø¹Ø±ÙˆØ¶</option>
            </select>
        </div>
        <button class="reset-btn" id="reset-filters" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±">
            <i class="fas fa-redo"></i>
            Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
        </button>
    </div>

    <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ -->
    <button class="scroll-to-top" id="scroll-to-top" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- Ø²Ø± ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø±ÙŠØ· -->
    <button class="filter-control" id="filter-control" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ±">
        <i class="fas fa-sliders-h"></i>
    </button>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <div class="page-content">
        <div id="products-container">
            <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        </div>
    </div>

    <!-- Ø§Ù„ÙÙˆØªØ± -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-text" id="footer-text">
                Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø¯Ù‰ Ø§Ù„Ù…Ù…ÙŠØ² Ø³ÙˆÙØª Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
            </div>
        </div>
    </footer>

    <script>
        // ==========================================
        // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Firebase
        // ==========================================
        const firebaseConfig = { 
            databaseURL: "https://chat-fat-free-default-rtdb.firebaseio.com/" 
        };
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                console.log('âœ… Firebase initialized successfully');
            }
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:", error);
        }
        
        const db = firebase.database();

        // ==========================================
        // ğŸ¯ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ==========================================
        let allProducts = [];
        let allMerchants = [];
        let allGovernorates = [];
        let allRegions = [];
        let allCategories = [];
        let favoriteProducts = JSON.parse(localStorage.getItem('favoriteProducts')) || {};
        let showFavoritesOnly = false;
        
        // ==========================================
        // ğŸ¯ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        // ==========================================
        const productsContainer = document.getElementById('products-container');
        const governorateInput = document.getElementById('governorate-input');
        const regionInput = document.getElementById('region-input');
        const categoryInput = document.getElementById('category-input');
        const merchantInput = document.getElementById('merchant-input');
        const searchInput = document.getElementById('search');
        const resetButton = document.getElementById('reset-filters');
        const sortSelect = document.getElementById('sort-by');
        const filterBar = document.getElementById('filter-bar');
        const scrollToTopBtn = document.getElementById('scroll-to-top');
        const filterControlBtn = document.getElementById('filter-control');
        const secondaryCategoryInput = document.getElementById('secondary-category-input');
        const productsCountEl = document.getElementById('products-count');
        const showMoreBtn = document.getElementById('show-more-btn');
        const secondaryFavoritesBtn = document.getElementById('secondary-favorites');
        const noDataModal = document.getElementById('no-data-modal');
        const editSearchBtn = document.getElementById('edit-search-btn');
        const resetFiltersModalBtn = document.getElementById('reset-filters-modal-btn');

        // ==========================================
        // ğŸ¯ ComboBox Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø§Ù„Ø¨Ø­Ø«
        // ==========================================
        class CustomComboBox {
            constructor(inputElement, dropdownElement, options = []) {
                this.input = inputElement;
                this.dropdown = dropdownElement;
                this.options = options;
                this.filteredOptions = options;
                this.selectedOption = null;
                this.isOpen = false;

                this.init();
            }

            init() {
                this.input.addEventListener('input', () => this.handleInput());
                this.input.addEventListener('focus', () => this.openDropdown());
                this.input.addEventListener('blur', () => {
                    setTimeout(() => this.closeDropdown(), 200);
                });
                this.input.addEventListener('keydown', (e) => this.handleKeydown(e));

                this.populateDropdown();
            }

            setOptions(newOptions) {
                this.options = newOptions;
                this.filteredOptions = newOptions;
                this.populateDropdown();
            }

            populateDropdown() {
                this.dropdown.innerHTML = '';
                
                this.filteredOptions.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'combobox-option';
                    optionElement.textContent = option.text;
                    optionElement.dataset.value = option.value;
                    
                    if (option.value === this.selectedOption?.value) {
                        optionElement.classList.add('selected');
                    }
                    
                    optionElement.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        this.selectOption(option);
                    });
                    
                    this.dropdown.appendChild(optionElement);
                });
            }

            handleInput() {
                const searchText = this.normalizeArabicText(this.input.value);
                this.filteredOptions = this.options.filter(option => 
                    this.normalizeArabicText(option.text).includes(searchText)
                );
                this.populateDropdown();
                this.openDropdown();
            }

            handleKeydown(e) {
                const options = this.dropdown.querySelectorAll('.combobox-option');
                const currentIndex = Array.from(options).findIndex(opt => opt.classList.contains('selected'));
                
                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        const nextIndex = currentIndex < options.length - 1 ? currentIndex + 1 : 0;
                        this.highlightOption(nextIndex);
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        const prevIndex = currentIndex > 0 ? currentIndex - 1 : options.length - 1;
                        this.highlightOption(prevIndex);
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (currentIndex >= 0) {
                            this.selectOption(this.filteredOptions[currentIndex]);
                        }
                        break;
                    case 'Escape':
                        this.closeDropdown();
                        break;
                }
            }

            highlightOption(index) {
                const options = this.dropdown.querySelectorAll('.combobox-option');
                options.forEach(opt => opt.classList.remove('selected'));
                if (options[index]) {
                    options[index].classList.add('selected');
                    options[index].scrollIntoView({ block: 'nearest' });
                }
            }

            selectOption(option) {
                this.selectedOption = option;
                this.input.value = option.text;
                this.closeDropdown();
                
                // ØªØ´ØºÙŠÙ„ Ø­Ø¯Ø« Ø§Ù„ØªØºÙŠÙŠØ±
                this.input.dispatchEvent(new Event('change', { bubbles: true }));
            }

            openDropdown() {
                this.isOpen = true;
                this.dropdown.classList.add('active');
            }

            closeDropdown() {
                this.isOpen = false;
                this.dropdown.classList.remove('active');
            }

            getValue() {
                return this.selectedOption ? this.selectedOption.value : '';
            }

            getText() {
                return this.selectedOption ? this.selectedOption.text : '';
            }

            setValue(value) {
                const option = this.options.find(opt => opt.value === value);
                if (option) {
                    this.selectOption(option);
                } else {
                    this.selectedOption = null;
                    this.input.value = '';
                }
            }

            clear() {
                this.selectedOption = null;
                this.input.value = '';
                this.filteredOptions = this.options;
                this.populateDropdown();
            }

            // ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ø¯Ø¹Ù… Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©
            normalizeArabicText(text) {
                if (!text) return '';
                
                return text
                    .toString()
                    .toLowerCase()
                    .replace(/[Ø£Ø¥Ø¢Ù±]/g, 'Ø§')
                    .replace(/Ø©/g, 'Ù‡')
                    .replace(/[Ù‰Ø¦]/g, 'ÙŠ')
                    .replace(/[Ø¡Ø¤]/g, '')
                    .replace(/[ï»»ï»·ï»µï»¹]/g, 'Ù„Ø§')
                    .replace(/[ï»™]/g, 'Ùƒ')
                    .replace(/[ï»«]/g, 'Ù‡')
                    .replace(/[ï»¯ï»±]/g, 'ÙŠ');
            }
        }

        // ==========================================
        // ğŸ¯ ØªÙ‡ÙŠØ¦Ø© ComboBoxes
        // ==========================================
        let categoryCombobox, governorateCombobox, regionCombobox, merchantCombobox, secondaryCategoryCombobox;

        function initializeComboBoxes() {
            categoryCombobox = new CustomComboBox(
                document.getElementById('category-input'),
                document.getElementById('category-dropdown'),
                []
            );

            governorateCombobox = new CustomComboBox(
                document.getElementById('governorate-input'),
                document.getElementById('governorate-dropdown'),
                []
            );

            regionCombobox = new CustomComboBox(
                document.getElementById('region-input'),
                document.getElementById('region-dropdown'),
                []
            );

            merchantCombobox = new CustomComboBox(
                document.getElementById('merchant-input'),
                document.getElementById('merchant-dropdown'),
                []
            );

            secondaryCategoryCombobox = new CustomComboBox(
                document.getElementById('secondary-category-input'),
                document.getElementById('secondary-category-dropdown'),
                []
            );

            console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø¬Ù…ÙŠØ¹ ComboBoxes Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ==========================================
        // ğŸ¯ ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª ComboBoxes
        // ==========================================
        function updateComboBoxOptions() {
            // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø³Ù…
            const categoryOptions = allCategories.map(cat => ({
                value: cat.id,
                text: cat.name
            }));
            categoryCombobox.setOptions([{ value: '', text: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…' }, ...categoryOptions]);
            secondaryCategoryCombobox.setOptions([{ value: '', text: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…' }, ...categoryOptions]);

            // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
            const governorateOptions = allGovernorates.map(gov => ({
                value: gov.id || gov.name,
                text: gov.name || gov.id
            }));
            governorateCombobox.setOptions([{ value: '', text: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª' }, ...governorateOptions]);

            // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
            updateRegionComboBoxOptions();

            // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ§Ø¬Ø±
            updateMerchantComboBoxOptions();

            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø¬Ù…ÙŠØ¹ ComboBoxes');
        }

        // ==========================================
        // ğŸ¯ ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
        // ==========================================
        function updateRegionComboBoxOptions() {
            const selectedGovernorate = governorateCombobox.getValue();
            
            let filteredRegions = allRegions;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ø­Ø§ÙØ¸Ø© Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù†ÙÙ„ØªØ± Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„ÙŠÙ‡Ø§
            if (selectedGovernorate) {
                filteredRegions = allRegions.filter(region => {
                    // Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ø¨Ø± Ø­Ù‚Ù„ governorate Ø£Ùˆ region
                    return region.governorate === selectedGovernorate || 
                           region.parent === selectedGovernorate ||
                           !region.governorate; // ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø§ÙØ¸Ø© Ù…Ø­Ø¯Ø¯Ø©
                });
            }
            
            const regionOptions = filteredRegions.map(reg => ({
                value: reg.id || reg.name,
                text: reg.name || reg.id
            }));
            
            regionCombobox.setOptions([{ value: '', text: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚' }, ...regionOptions]);
        }

        // ==========================================
        // ğŸ¯ ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ§Ø¬Ø±
        // ==========================================
        function updateMerchantComboBoxOptions() {
            const selectedGovernorate = governorateCombobox.getValue();
            const selectedRegion = regionCombobox.getValue();
            
            let filteredMerchants = allMerchants.filter(m => {
                const isActive = m.status === "active" || m.status === "Ù†Ø´Ø·";
                const isMerchant = m.job === "ØªØ§Ø¬Ø±" || m.type === "ØªØ§Ø¬Ø±";
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ø­Ø§ÙØ¸Ø© Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù†ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
                if (selectedGovernorate) {
                    const merchantGovernorate = m.governorate || m.region;
                    if (merchantGovernorate !== selectedGovernorate) {
                        return false;
                    }
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù†ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
                if (selectedRegion) {
                    const merchantArea = m.area || m.city;
                    if (merchantArea !== selectedRegion) {
                        return false;
                    }
                }
                
                return isActive && isMerchant;
            });
            
            filteredMerchants.sort((a, b) => {
                const nameA = (a.name || a.username || '').toLowerCase();
                const nameB = (b.name || b.username || '').toLowerCase();
                return nameA.localeCompare(nameB);
            });

            const merchantOptions = filteredMerchants.map(m => ({
                value: m.id,
                text: m.name || m.username || m.id
            }));

            merchantCombobox.setOptions([{ value: '', text: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¬Ø§Ø±' }, ...merchantOptions]);
        }

        // ==========================================
        // ğŸ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        // ==========================================
        async function loadAllData() {
            try {
                console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²ÙŠ
                const [productsSnap, merchantsSnap, governoratesSnap, regionsSnap, categoriesSnap] = await Promise.all([
                    db.ref("products").once("value"),
                    db.ref("merchants").once("value"),
                    db.ref("governorates").once("value"),
                    db.ref("regions").once("value"),
                    db.ref("categories").once("value")
                ]);

                allProducts = convertFirebaseData(productsSnap.val()) || [];
                allMerchants = convertFirebaseData(merchantsSnap.val()) || [];
                allGovernorates = convertFirebaseData(governoratesSnap.val()) || [];
                allRegions = convertFirebaseData(regionsSnap.val()) || [];
                allCategories = convertFirebaseData(categoriesSnap.val()) || [];

                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', {
                    products: allProducts.length,
                    merchants: allMerchants.length,
                    governorates: allGovernorates.length,
                    regions: allRegions.length,
                    categories: allCategories.length
                });

                // ØªØ­Ø¯ÙŠØ« ComboBoxes
                updateComboBoxOptions();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                displayProducts(allProducts);
                
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                productsContainer.innerHTML = `
                    <div class="error">
                        <h3>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                        <p>${error.message || 'ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„'}</p>
                        <p>ÙŠØ±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</p>
                        <button onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„</button>
                    </div>
                `;
            }
        }

        function convertFirebaseData(firebaseData) {
            if (!firebaseData) return [];
            try {
                return Object.entries(firebaseData).map(([id, data]) => 
                    data && data.id ? ({ ...data }) : ({ id, ...data }));
            } catch (e) {
                console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", e);
                return [];
            }
        }

        // ==========================================
        // ğŸ¯ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        // ==========================================
        function displayProducts(products) {
            if (showFavoritesOnly) {
                displayFavoriteProducts();
                return;
            }
            
            productsContainer.innerHTML = '';
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø·
            const activeProducts = products.filter(product => {
                const merchant = allMerchants.find(m => m.id === product.userId);
                if (!merchant) return false;
                
                const isActive = merchant.status === "active" || merchant.status === "Ù†Ø´Ø·";
                const isMerchant = merchant.job === "ØªØ§Ø¬Ø±" || merchant.type === "ØªØ§Ø¬Ø±";
                
                return isActive && isMerchant;
            });

            if (!activeProducts || activeProducts.length === 0) {
                showNoDataModal();
                return;
            }

            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            productsCountEl.textContent = ` ${activeProducts.length}`;

            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const sorted = sortProductsByPriority(activeProducts);

            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
            const groupedProducts = groupProductsByCategory(sorted);

            displayGroupedProducts(groupedProducts);
        }

        function groupProductsByCategory(products) {
            const groups = {};
            
            products.forEach(p => {
                const categoryId = p.categoryId || 'ØºÙŠØ± Ù…ØµÙ†Ù';
                const categoryName = p.categoryId ? 
                    (allCategories.find(c => c.id === p.categoryId)?.name || 'ØºÙŠØ± Ù…ØµÙ†Ù') : 'ØºÙŠØ± Ù…ØµÙ†Ù';
                
                if (!groups[categoryId]) {
                    groups[categoryId] = {
                        name: categoryName,
                        products: []
                    };
                }
                
                groups[categoryId].products.push(p);
            });
            
            return groups;
        }

        function displayGroupedProducts(groupedProducts) {
            const grid = document.createElement('div');
            grid.className = 'products';

            Object.keys(groupedProducts).forEach(categoryId => {
                const group = groupedProducts[categoryId];
                
                const categoryContainer = document.createElement('div');
                categoryContainer.className = 'category-container';
                categoryContainer.id = `category-${categoryId}`;
                
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'category-title';
                categoryTitle.textContent = group.name;
                
                const categoryCount = document.createElement('div');
                categoryCount.className = 'category-count';
                categoryCount.textContent = `${group.products.length} Ù…Ù†ØªØ¬`;
                
                categoryHeader.appendChild(categoryTitle);
                categoryHeader.appendChild(categoryCount);
                categoryContainer.appendChild(categoryHeader);
                
                group.products.forEach(p => {
                    const merchant = allMerchants.find(m => m.id === p.userId);
                    if (!merchant) return;
                    
                    const card = createProductCard(p, merchant);
                    categoryContainer.appendChild(card);
                });
                
                grid.appendChild(categoryContainer);
            });

            if (grid.children.length === 0) {
                productsContainer.innerHTML = `
                    <div class="no-products">
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
                        <button onclick="resetFilters()" style="margin-top:10px;padding:10px 20px;background:var(--primary-color);color:#fff;border:none;border-radius:5px;cursor:pointer">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
                    </div>
                `;
            } else {
                productsContainer.appendChild(grid);
            }
        }

        function createProductCard(product, merchant) {
            const merchantName = merchant.name || merchant.username || "ØªØ§Ø¬Ø±";
            const productName = product.name || 'Ù…Ù†ØªØ¬ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';

            const card = document.createElement('div');
            card.className = 'card';
            card.id = `product-${product.id}`;

            // ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬
            const imageDiv = document.createElement('div');
            imageDiv.className = 'images-preview';
            const img = document.createElement('img');
            img.loading = 'lazy'; 
            img.decoding = 'async';

            const imageUrls = extractImageUrls(product);
            const imageUrl = imageUrls[0] || '';
            
            if (imageUrl) {
                img.src = formatDriveUrl(imageUrl, 'thumb');
                img.alt = productName;
            } else {
                img.src = 'https://drive.google.com/thumbnail?id=1-qn1bTCIhgF1E5wm5RVRdm1pYLeNZCNC&sz=w800';
                img.alt = 'ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©';
                img.style.border = '1px dashed #ccc';
            }
            
            imageDiv.appendChild(img);
            card.appendChild(imageDiv);

            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
            const infoDiv = document.createElement('div');
            infoDiv.className = 'info';

            const title = document.createElement('h3'); 
            title.textContent = productName; 
            infoDiv.appendChild(title);

            if (product.price) {
                const priceDiv = document.createElement('div'); 
                priceDiv.className = 'product-price';
                const currency = product.currency || 'Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ';
                priceDiv.textContent = `${product.price} ${currency}`; 
                infoDiv.appendChild(priceDiv);
            }

            const detailsDiv = document.createElement('div'); 
            detailsDiv.className = 'product-details';
            
            if (product.description) {
                const descItem = document.createElement('div'); 
                descItem.className = 'product-detail-item';
                let descriptionText = escapeHtml(product.description);
                if (product.date) {
                    descriptionText += `<br><small style="color: #888; margin-top: 5px; display: block;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${formatDate(product.date)}</small>`;
                }
                descItem.innerHTML = `<span class="label">Ø§Ù„ÙˆØµÙ:</span> <span style="text-align:right;direction:rtl;display:block;width:100%;">${descriptionText}</span>`;
                detailsDiv.appendChild(descItem);
            }
            
            infoDiv.appendChild(detailsDiv);

            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø±
            const merchantDiv = document.createElement('div'); 
            merchantDiv.className = 'merchant-info';
            
            const merchantNameEl = document.createElement('div'); 
            merchantNameEl.className = 'merchant-name';
            merchantNameEl.innerHTML = `ğŸ“ ${escapeHtml(merchantName)}`;
            merchantNameEl.title = 'Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„ØªØ§Ø¬Ø±';
            merchantDiv.appendChild(merchantNameEl);
            
            infoDiv.appendChild(merchantDiv);

            card.appendChild(infoDiv);

            return card;
        }

        function extractImageUrls(product) {
            let imageUrls = [];
            if (product.imageUrls) {
                if (Array.isArray(product.imageUrls)) 
                    imageUrls = product.imageUrls.filter(u => u && u.trim() !== '');
                else if (typeof product.imageUrls === 'string') 
                    imageUrls = product.imageUrls.split(',').map(u => u.trim()).filter(Boolean);
            }
            if (imageUrls.length === 0 && product.imageUrl && typeof product.imageUrl === 'string') {
                imageUrls = product.imageUrl.split(/[,\n]/).map(u => u.trim()).filter(Boolean);
            }
            
            if (imageUrls.length === 0) {
                imageUrls = ['https://drive.google.com/thumbnail?id=1-qn1bTCIhgF1E5wm5RVRdm1pYLeNZCNC&sz=w800'];
            }
            
            return imageUrls;
        }

        function formatDriveUrl(url, mode = 'thumb') {
            if (!url) return '';
            
            if (url.includes('1-qn1bTCIhgF1E5wm5RVRdm1pYLeNZCNC')) {
                return url;
            }
            
            let id = '';
            
            if (url.includes('/d/')) {
                id = url.split('/d/')[1].split('/')[0];
            } 
            else if (url.includes('id=')) {
                try { 
                    id = new URLSearchParams(url.split('?')[1]).get('id') || ''; 
                } catch { 
                    return url; 
                }
            }
            else if (url.includes('/file/d/')) {
                id = url.split('/file/d/')[1].split('/')[0];
            }
            else if (url.includes('drive.google.com/uc?id=')) {
                id = url.split('drive.google.com/uc?id=')[1].split('&')[0];
            }
            
            if (!id) return url;

            if (mode === 'thumb') {
                return `https://drive.google.com/thumbnail?id=${id}&sz=w800`;
            } else if (mode === 'main') {
                return `https://drive.google.com/thumbnail?id=${id}&sz=w1600`;
            }
            return url;
        }

        function sortProductsByPriority(products) {
            const sortBy = sortSelect.value;
            
            if (sortBy && sortBy !== 'date' && sortBy !== 'preference' && sortBy !== 'offers') {
                return sortProductsByOption(products, sortBy);
            }
            
            if (sortBy === 'preference') {
                return sortProductsByPreference(products);
            }
            
            if (sortBy === 'offers') {
                return sortProductsByOffers(products);
            }
            
            return [...products].sort((a, b) => {
                const aDate = new Date(a.publishDate || a.createdAt || a.date || 0);
                const bDate = new Date(b.publishDate || b.createdAt || b.date || 0);
                return bDate - aDate;
            });
        }

        function sortProductsByOption(products, sortBy) {
            return [...products].sort((a, b) => {
                let result = 0;
                
                switch(sortBy) {
                    case 'name':
                        const nameA = (a.name || '').toLowerCase();
                        const nameB = (b.name || '').toLowerCase();
                        result = nameA.localeCompare(nameB);
                        break;
                    
                    case 'category':
                        const categoryA = getCategoryName(a.categoryId) || '';
                        const categoryB = getCategoryName(b.categoryId) || '';
                        result = categoryA.localeCompare(categoryB);
                        break;
                    
                    case 'price':
                        const priceA = parseFloat(a.price) || 0;
                        const priceB = parseFloat(b.price) || 0;
                        result = priceA - priceB;
                        break;
                    
                    case 'merchant':
                        const merchantA = getMerchantName(a.userId) || '';
                        const merchantB = getMerchantName(b.userId) || '';
                        result = merchantA.localeCompare(merchantB);
                        break;
                    
                    case 'date':
                    default:
                        const dateA = new Date(a.publishDate || a.createdAt || a.date || 0);
                        const dateB = new Date(b.publishDate || b.createdAt || b.date || 0);
                        result = dateB - dateA;
                        break;
                }
                
                if (result === 0) {
                    const dateA = new Date(a.publishDate || a.createdAt || a.date || 0);
                    const dateB = new Date(b.publishDate || b.createdAt || b.date || 0);
                    return dateB - dateA;
                }
                
                return result;
            });
        }

        function sortProductsByPreference(products) {
            return [...products].sort((a, b) => {
                const aPreferenceScore = calculatePreferenceScore(a);
                const bPreferenceScore = calculatePreferenceScore(b);
                
                if (aPreferenceScore !== bPreferenceScore) {
                    return bPreferenceScore - aPreferenceScore;
                }
                
                const aDate = new Date(a.publishDate || a.createdAt || a.date || 0);
                const bDate = new Date(b.publishDate || b.createdAt || b.date || 0);
                return bDate - aDate;
            });
        }

        function sortProductsByOffers(products) {
            const offerProducts = products.filter(p => p.productType === 'Ø¹Ø±Ø¶' && isOfferValid(p));
            return offerProducts.sort((a, b) => {
                const aDate = new Date(a.publishDate || a.createdAt || a.date || 0);
                const bDate = new Date(b.publishDate || b.createdAt || b.date || 0);
                return bDate - aDate;
            });
        }

        function calculatePreferenceScore(product) {
            let score = 0;
            return score;
        }

        function getCategoryName(categoryId) {
            const category = allCategories.find(c => c.id === categoryId);
            return category ? category.name : '';
        }

        function getMerchantName(merchantId) {
            const merchant = allMerchants.find(m => m.id === merchantId);
            return merchant ? (merchant.name || merchant.username) : '';
        }

        function isOfferValid(product) {
            if (!product.productType || product.productType !== 'Ø¹Ø±Ø¶') {
                return false;
            }
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (product.endDate) {
                const endDate = new Date(product.endDate);
                endDate.setHours(0, 0, 0, 0);
                if (today > endDate) {
                    return false;
                }
            }
            
            if (product.startDate) {
                const startDate = new Date(product.startDate);
                startDate.setHours(0, 0, 0, 0);
                if (today < startDate) {
                    return false;
                }
            }
            
            return true;
        }

        // ==========================================
        // ğŸ¯ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©
        // ==========================================
        function displayFavoriteProducts() {
            productsContainer.innerHTML = '';
            
            const favoriteProductIds = Object.keys(favoriteProducts);
            const favoriteProductsList = allProducts.filter(p => favoriteProductIds.includes(p.id));
            
            if (favoriteProductsList.length === 0) {
                productsContainer.innerHTML = `
                    <div class="no-products">
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø©</p>
                        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù„Ø¨ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</p>
                        <button onclick="closeFavoritesView()" style="margin-top:10px;padding:10px 20px;background:var(--primary-color);color:#fff;border:none;border-radius:5px;cursor:pointer">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¯ÙŠ</button>
                    </div>
                `;
                return;
            }

            const favoritesTitle = document.createElement('h2');
            favoritesTitle.style.textAlign = 'center';
            favoritesTitle.style.margin = '20px 0';
            favoritesTitle.style.color = 'var(--primary-color)';
            favoritesTitle.textContent = 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©';
            productsContainer.appendChild(favoritesTitle);

            const groupedFavorites = groupProductsByCategory(favoriteProductsList);
            displayGroupedProducts(groupedFavorites);

            const backButton = document.createElement('div');
            backButton.style.textAlign = 'center';
            backButton.style.margin = '20px 0';
            backButton.innerHTML = `
                <button onclick="closeFavoritesView()" style="padding:10px 20px;background:var(--primary-color);color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:16px;">
                    Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                </button>
            `;
            productsContainer.appendChild(backButton);
        }

        function closeFavoritesView() {
            showFavoritesOnly = false;
            filterProducts();
        }

        function toggleFavoritesView() {
            showFavoritesOnly = !showFavoritesOnly;
            
            if (showFavoritesOnly) {
                displayFavoriteProducts();
            } else {
                filterProducts();
            }
        }

        // ==========================================
        // ğŸ¯ ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        // ==========================================
        function filterProducts() {
            const filters = {
                governorate: governorateCombobox.getValue(),
                region: regionCombobox.getValue(),
                category: categoryCombobox.getValue(),
                merchant: merchantCombobox.getValue(),
                search: (searchInput.value || '').trim(),
                sortBy: sortSelect.value
            };

            const result = allProducts.filter(product => {
                if (!product) return false;
                const merchant = allMerchants.find(m => m.id === product.userId);
                if (!merchant) return false;

                const isActive = merchant.status === "active" || merchant.status === "Ù†Ø´Ø·";
                const isMerchant = merchant.job === "ØªØ§Ø¬Ø±" || merchant.type === "ØªØ§Ø¬Ø±";
                
                if (!isActive || !isMerchant) return false;

                if (filters.search) {
                    const normalizedSearch = normalizeSearchText(filters.search);
                    const productText = normalizeSearchText(`${product.name || ''} ${product.description || ''}`);
                    if (!productText.includes(normalizedSearch)) return false;
                }

                if (filters.category) {
                    if (product.categoryId !== filters.category && product.category !== filters.category) return false;
                }

                if (filters.merchant && product.userId !== filters.merchant) return false;

                if (filters.governorate) {
                    const merchantGovernorate = merchant.governorate || merchant.region;
                    if (merchantGovernorate !== filters.governorate) return false;
                }
                if (filters.region) {
                    const merchantArea = merchant.area || merchant.city;
                    if (merchantArea !== filters.region) return false;
                }

                return true;
            });

            displayProducts(result);
        }

        function normalizeSearchText(text) {
            if (!text) return '';
            
            return text
                .toString()
                .toLowerCase()
                .replace(/[Ø£Ø¥Ø¢Ù±]/g, 'Ø§')
                .replace(/Ø©/g, 'Ù‡')
                .replace(/[Ù‰Ø¦]/g, 'ÙŠ')
                .replace(/[Ø¡Ø¤]/g, '')
                .replace(/[ï»»ï»·ï»µï»¹]/g, 'Ù„Ø§')
                .replace(/[ï»™]/g, 'Ùƒ')
                .replace(/[ï»«]/g, 'Ù‡')
                .replace(/[ï»¯ï»±]/g, 'ÙŠ');
        }

        // ==========================================
        // ğŸ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
        // ==========================================
        function resetFilters() {
            // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙÙ„ØªØ±Ø©
            categoryCombobox.clear();
            governorateCombobox.clear();
            regionCombobox.clear();
            merchantCombobox.clear();
            searchInput.value = '';
            sortSelect.value = 'date';
            secondaryCategoryCombobox.clear();
            
            // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙˆØ§Ù„ØªØ¬Ø§Ø±
            updateRegionComboBoxOptions();
            updateMerchantComboBoxOptions();
            
            // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            displayProducts(allProducts);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¹Ø¯Ù… ØªÙˆÙØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
            noDataModal.classList.remove('active');
            
            console.log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±');
        }

        // ==========================================
        // ğŸ¯ Ø¥Ø¯Ø§Ø±Ø© Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ±
        // ==========================================
        function toggleFilterBar() {
            const isFilterBarHidden = localStorage.getItem('filterBarHidden');
            if (isFilterBarHidden === 'true') {
                showFilterBar();
            } else {
                hideFilterBar();
            }
        }

        function hideFilterBar() {
            filterBar.style.display = 'none';
            document.body.style.paddingTop = '128px';
            localStorage.setItem('filterBarHidden', 'true');
            filterControlBtn.innerHTML = '<i class="fas fa-sliders-h"></i>';
            filterControlBtn.title = 'Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ±';
            showMoreBtn.innerHTML = '<i class="fas fa-bars"></i> Ø£ÙƒØ«Ø±';
        }

        function showFilterBar() {
            filterBar.style.display = 'flex';
            document.body.style.paddingTop = '180px';
            localStorage.setItem('filterBarHidden', 'false');
            filterControlBtn.innerHTML = '<i class="fas fa-times"></i>';
            filterControlBtn.title = 'Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ±';
            showMoreBtn.innerHTML = '<i class="fas fa-times"></i> Ø¥Ø®ÙØ§Ø¡';
        }

        // ==========================================
        // ğŸ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        // ==========================================
        function showNoDataModal() {
            noDataModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // ==========================================
        // ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        // ==========================================
        function setupEventListeners() {
            // Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ÙÙ„Ø§ØªØ±
            searchInput.addEventListener('input', debounce(filterProducts, 300));
            categoryInput.addEventListener('change', handleCategoryChange);
            governorateInput.addEventListener('change', handleGovernorateChange);
            regionInput.addEventListener('change', handleRegionChange);
            merchantInput.addEventListener('change', handleMerchantChange);
            sortSelect.addEventListener('change', filterProducts);
            resetButton.addEventListener('click', resetFilters);
            filterControlBtn.addEventListener('click', toggleFilterBar);
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯
            secondaryCategoryInput.addEventListener('change', handleSecondaryCategoryChange);
            showMoreBtn.addEventListener('click', toggleFilterBar);
            secondaryFavoritesBtn.addEventListener('click', toggleFavoritesView);

            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            editSearchBtn.addEventListener('click', () => {
                noDataModal.classList.remove('active');
                showFilterBar();
            });

            resetFiltersModalBtn.addEventListener('click', () => {
                noDataModal.classList.remove('active');
                resetFilters();
            });

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            noDataModal.addEventListener('click', (e) => {
                if (e.target.id === 'no-data-modal') {
                    noDataModal.classList.remove('active');
                }
            });

            // Ø­Ø¯Ø« Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰
            window.addEventListener('scroll', handleScroll);
            scrollToTopBtn.addEventListener('click', scrollToTop);
        }

        function handleGovernorateChange() { 
            updateRegionComboBoxOptions();
            updateMerchantComboBoxOptions();
            filterProducts(); 
        }

        function handleRegionChange() { 
            updateMerchantComboBoxOptions();
            filterProducts(); 
        }

        function handleMerchantChange() { 
            filterProducts(); 
        }

        function handleSecondaryCategoryChange() {
            categoryCombobox.setValue(secondaryCategoryCombobox.getValue());
            filterProducts();
        }

        function handleCategoryChange() { 
            secondaryCategoryCombobox.setValue(categoryCombobox.getValue());
            filterProducts(); 
        }

        function handleScroll() {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // ==========================================
        // ğŸ¯ Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ==========================================
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function formatDate(dateString) {
            if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            try { 
                return new Date(dateString).toLocaleDateString('ar-EG'); 
            } catch { 
                return dateString; 
            }
        }

        function escapeHtml(text) { 
            const div = document.createElement('div'); 
            div.textContent = text; 
            return div.innerHTML; 
        }

        // ==========================================
        // ğŸ¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
            
            // ØªÙ‡ÙŠØ¦Ø© ComboBoxes
            initializeComboBoxes();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            setupEventListeners();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            loadAllData().then(() => {
                console.log('ğŸ‰ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            }).catch(error => {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            });
        });
    </script>
</body>
</html>
